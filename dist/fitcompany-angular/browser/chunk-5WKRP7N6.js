import{a as z}from"./chunk-3CZEIJU6.js";import{a as C,b as T,c as h,d as N,e as V,g as D,h as O,k as F,p as A,r as L}from"./chunk-R2MBKBQG.js";import"./chunk-Y5NMKK7J.js";import{B as y,Ca as M,Ga as c,Mb as I,Nb as P,R as w,Sa as l,Sb as k,Ta as o,Ua as e,Va as x,X as g,Y as u,Ya as _,Za as p,_a as m,db as S,eb as r,fb as E,gb as f,ta as d}from"./chunk-4VXNIXON.js";function G(n,t){if(n&1&&(o(0,"div",23),r(1),e()),n&2){let i=m();d(),f(" ",i.okMsg," ")}}function $(n,t){if(n&1&&(o(0,"div",24),r(1),e()),n&2){let i=m();d(),f(" ",i.errorMsg," ")}}function q(n,t){if(n&1){let i=_();o(0,"button",25),p("click",function(){g(i);let s=m();return u(s.cancelarEdicion())}),r(1," Cancelar "),e()}}function B(n,t){n&1&&(o(0,"div",26),r(1," Cargando... "),e())}function H(n,t){n&1&&(o(0,"div",26),r(1," No hay registros "),e())}function R(n,t){n&1&&(o(0,"span",38),r(1,"Activo"),e())}function Z(n,t){n&1&&(o(0,"span",39),r(1,"Inactivo"),e())}function J(n,t){if(n&1){let i=_();o(0,"tr",30)(1,"td",31),r(2),e(),o(3,"td",31),r(4),e(),o(5,"td",31),c(6,R,2,0,"span",33)(7,Z,2,0,"span",34),e(),o(8,"td",35)(9,"button",36),p("click",function(){let s=g(i).$implicit,b=m(2);return u(b.editar(s))}),r(10," Editar "),e(),o(11,"button",37),p("click",function(){let s=g(i).$implicit,b=m(2);return u(b.confirmarEliminar(s))}),r(12," Eliminar "),e()()()}if(n&2){let i=t.$implicit;S("opacity-60",!i.activo),d(2),E(i.nombre_metodo_pago),d(2),E(i.descripcion_metodo_pago||"-"),d(2),l("ngIf",i.activo),d(),l("ngIf",!i.activo)}}function K(n,t){if(n&1&&(o(0,"div",27)(1,"table",28)(2,"thead",29)(3,"tr",30)(4,"th",31),r(5,"Nombre"),e(),o(6,"th",31),r(7,"Descripci\xF3n"),e(),o(8,"th",31),r(9,"Estado"),e(),o(10,"th",31),r(11,"Acciones"),e()()(),o(12,"tbody"),c(13,J,13,6,"tr",32),e()()()),n&2){let i=m();d(13),l("ngForOf",i.rows)}}function Q(n,t){if(n&1){let i=_();o(0,"div",40),x(1,"div",41),o(2,"div",42)(3,"h3",43),r(4,"Confirmar eliminaci\xF3n"),e(),o(5,"p",44),r(6," \xBFSeguro que deseas eliminar este m\xE9todo de pago? "),e(),o(7,"div",45)(8,"button",46),p("click",function(){g(i);let s=m();return u(s.closeConfirm())}),r(9," Cancelar "),e(),o(10,"button",47),p("click",function(){g(i);let s=m();return u(s.doEliminarConfirmado())}),r(11," Eliminar "),e()()()()}}var j=class n{fb=w(A);metodosPagoSrv=w(z);rows=[];loadingList=!1;saving=!1;okMsg="";errorMsg="";form=this.fb.nonNullable.group({nombre_metodo_pago:["",[h.required,h.maxLength(100)]],descripcion_metodo_pago:["",[h.maxLength(255)]]});editando=!1;editId=null;confirmOpen=!1;pendingDeleteId=null;ngOnInit(){this.loadData()}autoHideMessages(t=4e3){window.setTimeout(()=>{this.okMsg="",this.errorMsg=""},t)}showOk(t){this.okMsg=t,this.errorMsg="",this.autoHideMessages(4e3)}showError(t){this.errorMsg=t,this.okMsg="",this.autoHideMessages(4e3)}loadData(){this.loadingList=!0,this.metodosPagoSrv.listar().subscribe({next:t=>{this.rows=t||[],this.loadingList=!1},error:()=>{this.rows=[],this.loadingList=!1,this.showError("Error cargando m\xE9todos de pago")}})}submit(){if(this.saving)return;let t=(this.form.value.nombre_metodo_pago||"").trim().replace(/\s+/g," "),i=(this.form.value.descripcion_metodo_pago||"").trim().replace(/\s+/g," ");if(!t)return this.showError("El nombre es obligatorio.");if(!/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s\-.]+$/.test(t))return this.showError("El nombre solo puede contener letras, espacios, guiones y puntos.");if(t.length>100)return this.showError("El nombre admite m\xE1ximo 100 caracteres.");if(i.length>200)return this.showError("La descripci\xF3n admite m\xE1ximo 200 caracteres.");this.saving=!0,this.okMsg="",this.errorMsg="";let s={nombre_metodo_pago:t,descripcion_metodo_pago:i};(this.editando&&this.editId!=null?this.metodosPagoSrv.actualizar(this.editId,s):this.metodosPagoSrv.crear(s)).pipe(y(()=>{this.saving=!1})).subscribe({next:v=>{this.showOk(v?.message||(this.editando?"M\xE9todo de pago actualizado.":"M\xE9todo de pago creado.")),this.loadData(),this.editando=!1,this.editId=null,this.form.reset({nombre_metodo_pago:"",descripcion_metodo_pago:""}),window.scrollTo({top:0,behavior:"smooth"})},error:v=>{this.showError(v?.error?.message||"Error al guardar el m\xE9todo de pago.")}})}editar(t){this.editando=!0,this.editId=t.id_metodo_pago??null,this.form.patchValue({nombre_metodo_pago:t.nombre_metodo_pago??"",descripcion_metodo_pago:t.descripcion_metodo_pago??""}),window.scrollTo({top:0,behavior:"smooth"})}cancelarEdicion(){this.editando=!1,this.editId=null,this.form.reset({nombre_metodo_pago:"",descripcion_metodo_pago:""})}confirmarEliminar(t){this.pendingDeleteId=t.id_metodo_pago??null,this.confirmOpen=!0}closeConfirm(){this.confirmOpen=!1,this.pendingDeleteId=null}doEliminarConfirmado(){if(this.pendingDeleteId==null){this.closeConfirm();return}let t=this.pendingDeleteId;this.confirmOpen=!1,this.pendingDeleteId=null,this.metodosPagoSrv.eliminar(t).subscribe({next:i=>{this.showOk(i?.message||"M\xE9todo de pago eliminado correctamente."),this.loadData()},error:i=>{this.showError(i?.error?.message||"Error eliminando el m\xE9todo de pago.")}})}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=M({type:n,selectors:[["app-metodos-pago"]],decls:35,vars:11,consts:[[1,"space-y-6"],[1,"text-center","text-xl","font-bold"],["class","mx-auto w-full max-w-3xl rounded-xl border border-green-500/40 bg-green-500/10 px-4 py-3 text-green-300 text-center",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center whitespace-pre-line",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-2xl","bg-surface-800","border","border-white/5","p-6","sm:p-7"],[1,"text-lg","font-semibold","text-brand-500","mb-4"],["novalidate","",1,"space-y-5",3,"ngSubmit","formGroup"],[1,"block","text-sm","mb-1"],[1,"text-brand-500"],["type","text","formControlName","nombre_metodo_pago","placeholder","Ej: Efectivo, Tarjeta de cr\xE9dito","autocomplete","off",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm"],["type","text","formControlName","descripcion_metodo_pago","placeholder","Breve descripci\xF3n del m\xE9todo",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm"],[1,"flex","items-center","gap-3"],["type","checkbox","formControlName","activo",1,"w-4","h-4","rounded"],[1,"text-sm"],[1,"flex","gap-3"],["type","submit",1,"flex-1","rounded-xl","border-2","border-dashed","border-brand-500/70","text-brand-500","font-semibold","py-3","hover:bg-brand-500","hover:text-black","transition","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-brand-500",3,"disabled"],["type","button","class","px-4 rounded-xl border border-white/10 hover:bg-white/5 transition",3,"click",4,"ngIf"],[1,"mx-auto","w-full","max-w-5xl"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","overflow-hidden"],[1,"px-6","py-4","border-b","border-white/5","font-semibold"],["class","px-6 py-10 text-center text-textc-mute",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","fixed inset-0 z-[60] flex items-center justify-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-green-500/40","bg-green-500/10","px-4","py-3","text-green-300","text-center"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center","whitespace-pre-line"],["type","button",1,"px-4","rounded-xl","border","border-white/10","hover:bg-white/5","transition",3,"click"],[1,"px-6","py-10","text-center","text-textc-mute"],[1,"overflow-x-auto"],[1,"w-full","text-left","text-sm"],[1,"bg-surface-900/60"],[1,"border-b","border-white/5"],[1,"px-6","py-3"],["class","border-b border-white/5",3,"opacity-60",4,"ngFor","ngForOf"],["class","text-green-300",4,"ngIf"],["class","text-gray-400",4,"ngIf"],[1,"px-6","py-3","whitespace-nowrap"],["type","button",1,"text-brand-500","hover:text-brand-600","mr-3",3,"click"],["type","button",1,"text-red-400","hover:text-red-300",3,"click"],[1,"text-green-300"],[1,"text-gray-400"],[1,"fixed","inset-0","z-[60]","flex","items-center","justify-center"],[1,"absolute","inset-0","bg-black/60"],[1,"relative","z-[61]","w-full","max-w-md","rounded-2xl","bg-surface-800","border","border-white/10","p-6","shadow-xl"],[1,"text-lg","font-semibold","mb-2"],[1,"text-sm","text-textc-mute"],[1,"mt-6","flex","gap-3","justify-end"],["type","button",1,"rounded-xl","border","border-white/10","px-4","py-2","hover:bg-white/5",3,"click"],["type","button",1,"rounded-xl","bg-red-500/90","text-black","font-semibold","px-4","py-2","hover:bg-red-400",3,"click"]],template:function(i,a){i&1&&(o(0,"div",0)(1,"h2",1),r(2,"Gesti\xF3n de M\xE9todos de Pago"),e(),c(3,G,2,1,"div",2)(4,$,2,1,"div",3),o(5,"section",4)(6,"h3",5),r(7),e(),o(8,"form",6),p("ngSubmit",function(){return a.submit()}),o(9,"div")(10,"label",7),r(11," Nombre del m\xE9todo "),o(12,"span",8),r(13,"*"),e()(),x(14,"input",9),e(),o(15,"div")(16,"label",7),r(17,"Descripci\xF3n"),e(),x(18,"input",10),e(),o(19,"div",11),x(20,"input",12),o(21,"label",13),r(22,"Activo"),e()(),o(23,"div",14)(24,"button",15),r(25),e(),c(26,q,2,0,"button",16),e()()(),o(27,"section",17)(28,"div",18)(29,"div",19),r(30,"Listado"),e(),c(31,B,2,0,"div",20)(32,H,2,0,"div",20)(33,K,14,1,"div",21),e()(),c(34,Q,12,0,"div",22),e()),i&2&&(d(3),l("ngIf",a.okMsg),d(),l("ngIf",a.errorMsg),d(3),f(" ",a.editando?"Editar m\xE9todo de pago":"Agregar m\xE9todo de pago"," "),d(),l("formGroup",a.form),d(16),l("disabled",a.saving),d(),f(" ",a.saving?"Guardando...":a.editando?"Actualizar":"Agregar"," "),d(),l("ngIf",a.editando),d(5),l("ngIf",a.loadingList),d(),l("ngIf",!a.loadingList&&a.rows.length===0),d(),l("ngIf",!a.loadingList&&a.rows.length>0),d(),l("ngIf",a.confirmOpen))},dependencies:[k,I,P,L,D,T,C,N,V,O,F],encapsulation:2})};export{j as MetodosPago};
