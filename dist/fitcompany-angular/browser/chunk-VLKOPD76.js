import{a as K,b as Q,c as _}from"./chunk-OLAEHZKR.js";import{b as L,c as I,d as k,e as B,f as $,g as G,h as z,k as U,l as W,m as j,n as q,p as H,q as Y,r as J}from"./chunk-R2MBKBQG.js";import"./chunk-Y5NMKK7J.js";import{Ca as D,Ga as h,Mb as N,Nb as O,Qb as X,R as w,Sa as s,Sb as M,Ta as i,Ua as t,Va as y,X as b,Y as S,Ya as F,Za as E,_a as f,db as C,eb as n,fb as m,gb as x,hb as P,kb as T,lb as R,mb as A,sb as v,ta as a,vb as g}from"./chunk-4VXNIXON.js";function le(r,o){if(r&1&&(i(0,"div",10),n(1),t()),r&2){let e=f();a(),x(" ",e.errorMsg," ")}}function de(r,o){if(r&1&&(i(0,"div",10),n(1),t()),r&2){let e=f();a(),x(" ",e.errorFecha," ")}}function se(r,o){if(r&1&&(i(0,"option",19),n(1),t()),r&2){let e=o.$implicit;s("value",e.value),a(),x(" ",e.label," ")}}function ce(r,o){if(r&1){let e=F();i(0,"div",11)(1,"div",12)(2,"label",13),n(3,"Per\xEDodo"),t(),i(4,"select",14),E("change",function(){b(e);let d=f();return S(d.onPeriodoChange())}),h(5,se,2,2,"option",15),t()(),i(6,"div",16)(7,"button",17),n(8),t(),i(9,"button",18),E("click",function(){b(e);let d=f();return S(d.exportarAExcel())}),n(10," Exportar Excel "),t()()()}if(r&2){let e=f();a(5),s("ngForOf",e.periodos),a(2),s("disabled",e.loading),a(),x(" ",e.loading?"Cargando...":"Cargar Datos"," "),a(),s("disabled",!e.datos||e.loading)}}function me(r,o){if(r&1&&(i(0,"option",19),n(1),t()),r&2){let e=o.$implicit;s("value",e.value),a(),x(" ",e.label," ")}}function pe(r,o){if(r&1){let e=F();i(0,"div",20)(1,"div")(2,"label",13),n(3,"Per\xEDodo"),t(),i(4,"select",14),E("change",function(){b(e);let d=f();return S(d.onPeriodoChange())}),h(5,me,2,2,"option",15),t()(),i(6,"div")(7,"label",13),n(8,"Fecha inicio"),t(),i(9,"input",21),E("change",function(){b(e);let d=f();return S(d.onFechaChange())}),t()(),i(10,"div")(11,"label",13),n(12,"Fecha fin"),t(),i(13,"input",22),E("change",function(){b(e);let d=f();return S(d.onFechaChange())}),t()(),i(14,"div",23)(15,"button",17),n(16),t(),i(17,"button",18),E("click",function(){b(e);let d=f();return S(d.exportarAExcel())}),n(18," Exportar Excel "),t()()()}if(r&2){let e,l,d,c,p=f();a(5),s("ngForOf",p.periodos),a(4),C("border-red-500",((e=p.form.get("fecha_inicio"))==null?null:e.invalid)&&((e=p.form.get("fecha_inicio"))==null?null:e.touched)),a(4),C("border-red-500",((l=p.form.get("fecha_fin"))==null?null:l.invalid)&&((l=p.form.get("fecha_fin"))==null?null:l.touched)),s("min",(d=p.form.get("fecha_inicio"))==null?null:d.value),a(2),s("disabled",p.loading||p.errorFecha!==""||!((c=p.form.get("fecha_inicio"))!=null&&c.value)||!((c=p.form.get("fecha_fin"))!=null&&c.value)||((c=p.form.get("fecha_fin"))==null?null:c.hasError("fechaAnterior"))),a(),x(" ",p.loading?"Cargando...":"Cargar Datos"," "),a(),s("disabled",!p.datos||p.loading)}}function fe(r,o){r&1&&(i(0,"div",47),n(1," No hay ventas en el per\xEDodo seleccionado "),t())}function ue(r,o){if(r&1&&(i(0,"tr",48)(1,"td",49),n(2),t(),i(3,"td",50),n(4),t(),i(5,"td",51),n(6),v(7,"currency"),t()()),r&2){let e=o.$implicit,l=f(3);a(2),m(l.formatearFecha(e.fecha)),a(2),m(e.cantidad),a(2),x(" ",g(7,3,e.total,"COP","symbol-narrow","1.0-0")," ")}}function xe(r,o){if(r&1&&(i(0,"div",39)(1,"table",40)(2,"colgroup"),y(3,"col",41)(4,"col",41)(5,"col",41),t(),i(6,"thead")(7,"tr",42)(8,"th",43),n(9,"Fecha"),t(),i(10,"th",44),n(11,"Cantidad"),t(),i(12,"th",44),n(13,"Total"),t()()(),i(14,"tbody"),h(15,ue,8,8,"tr",45),t()()()),r&2){let e=f(2);a(15),s("ngForOf",e.ventasPorDiaFiltradas)}}function he(r,o){if(r&1&&(i(0,"tr",48)(1,"td",49),n(2),t(),i(3,"td",50),n(4),t(),i(5,"td",51),n(6),v(7,"currency"),t()()),r&2){let e=o.$implicit;a(2),m(e.nombre),a(2),m(e.unidades),a(2),x(" ",g(7,3,e.total,"COP","symbol-narrow","1.0-0")," ")}}function _e(r,o){if(r&1&&(i(0,"tr",48)(1,"td",49),n(2),t(),i(3,"td",50),n(4),t(),i(5,"td",51),n(6),v(7,"currency"),t()()),r&2){let e=o.$implicit;a(2),m(e.nombre),a(2),m(e.ventas),a(2),x(" ",g(7,3,e.total,"COP","symbol-narrow","1.0-0")," ")}}function ve(r,o){if(r&1&&(i(0,"tr",56)(1,"td",59),n(2),t(),i(3,"td",57),n(4),t(),i(5,"td",57),n(6),t(),i(7,"td",57),n(8),v(9,"currency"),t(),i(10,"td",60),n(11),v(12,"currency"),t(),i(13,"td",61),n(14),v(15,"currency"),t(),i(16,"td",62),n(17),t()()),r&2){let e=o.$implicit,l=f(3);a(2),m(e.folio||"N/A"),a(2),m(l.formatearFecha(e.fecha)),a(2),m(e.cliente||"Sin cliente"),a(2),m(g(9,7,e.total,"COP","symbol-narrow","1.0-0")),a(3),m(g(12,12,e.pagado,"COP","symbol-narrow","1.0-0")),a(3),m(g(15,17,e.saldo_pendiente,"COP","symbol-narrow","1.0-0")),a(3),m(e.vendedor)}}function ge(r,o){if(r&1&&(i(0,"section",3)(1,"h3",4),n(2,"Cartera - Deudas Pendientes"),t(),i(3,"div",52)(4,"div",24)(5,"div",25),n(6,"Total por Cobrar"),t(),i(7,"div",53),n(8),v(9,"currency"),t()(),i(10,"div",24)(11,"div",25),n(12,"Ventas con Saldo Pendiente"),t(),i(13,"div",27),n(14),t()()(),i(15,"div",39)(16,"table",54)(17,"thead",55)(18,"tr",56)(19,"th",57),n(20,"Folio"),t(),i(21,"th",57),n(22,"Fecha"),t(),i(23,"th",57),n(24,"Cliente"),t(),i(25,"th",57),n(26,"Total Venta"),t(),i(27,"th",57),n(28,"Pagado"),t(),i(29,"th",57),n(30,"Saldo Pendiente"),t(),i(31,"th",57),n(32,"Vendedor"),t()()(),i(33,"tbody"),h(34,ve,18,22,"tr",58),t()()()()),r&2){let e=f(2);a(8),x(" ",g(9,3,e.datos.cartera.total_por_cobrar,"COP","symbol-narrow","1.0-0")," "),a(6),m(e.datos.cartera.cantidad_ventas_pendientes),a(20),s("ngForOf",e.datos.cartera.ventas_pendientes)}}function be(r,o){if(r&1){let e=F();i(0,"div",0)(1,"section",3)(2,"h3",4),n(3,"Resumen General"),t(),i(4,"div",20)(5,"div",24)(6,"div",25),n(7,"Total Ventas"),t(),i(8,"div",26),n(9),v(10,"currency"),t()(),i(11,"div",24)(12,"div",25),n(13,"Cantidad de Ventas"),t(),i(14,"div",27),n(15),t()(),i(16,"div",24)(17,"div",25),n(18,"Venta Promedio"),t(),i(19,"div",27),n(20),v(21,"currency"),t()(),i(22,"div",24)(23,"div",25),n(24,"Per\xEDodo"),t(),i(25,"div",28),n(26),t()()(),i(27,"div",29)(28,"div",24)(29,"div",25),n(30,"Ventas Contado"),t(),i(31,"div",30),n(32),t()(),i(33,"div",24)(34,"div",25),n(35,"Ventas Fiadas"),t(),i(36,"div",30),n(37),t()()()(),i(38,"section",3)(39,"div",31)(40,"h3",32),n(41,"Ventas por D\xEDa"),t(),i(42,"div",33)(43,"label",25),n(44,"Mostrar:"),t(),i(45,"select",34),A("ngModelChange",function(d){b(e);let c=f();return R(c.vistaVentasPorDia,d)||(c.vistaVentasPorDia=d),S(d)}),i(46,"option",35),n(47,"Solo d\xEDas con ventas"),t(),i(48,"option",36),n(49,"Todos los d\xEDas"),t()()()(),h(50,fe,2,0,"div",37)(51,xe,16,1,"div",38),t(),i(52,"section",3)(53,"h3",4),n(54,"Top 5 Productos M\xE1s Vendidos"),t(),i(55,"div",39)(56,"table",40)(57,"colgroup"),y(58,"col",41)(59,"col",41)(60,"col",41),t(),i(61,"thead")(62,"tr",42)(63,"th",43),n(64,"Producto"),t(),i(65,"th",44),n(66,"Unidades"),t(),i(67,"th",44),n(68,"Total"),t()()(),i(69,"tbody"),h(70,he,8,8,"tr",45),t()()()(),i(71,"section",3)(72,"h3",4),n(73,"Ventas por Vendedor"),t(),i(74,"div",39)(75,"table",40)(76,"colgroup"),y(77,"col",41)(78,"col",41)(79,"col",41),t(),i(80,"thead")(81,"tr",42)(82,"th",43),n(83,"Vendedor"),t(),i(84,"th",44),n(85,"Cantidad Ventas"),t(),i(86,"th",44),n(87,"Total Vendido"),t()()(),i(88,"tbody"),h(89,_e,8,8,"tr",45),t()()()(),h(90,ge,35,8,"section",46),t()}if(r&2){let e=f();a(9),x(" ",g(10,13,e.datos.resumen.total_ventas,"COP","symbol-narrow","1.0-0")," "),a(6),m(e.datos.resumen.cantidad_ventas),a(5),x(" ",g(21,18,e.datos.resumen.venta_promedio,"COP","symbol-narrow","1.0-0")," "),a(6),P(" ",e.formatearFecha(e.datos.periodo.fecha_inicio)," - ",e.formatearFecha(e.datos.periodo.fecha_fin)," "),a(6),m(e.datos.resumen.ventas_contado),a(5),m(e.datos.resumen.ventas_fiadas),a(8),T("ngModel",e.vistaVentasPorDia),a(5),s("ngIf",e.ventasPorDiaFiltradas.length===0),a(),s("ngIf",e.ventasPorDiaFiltradas.length>0),a(19),s("ngForOf",e.datos.productos_mas_vendidos),a(19),s("ngForOf",e.datos.vendedores),a(),s("ngIf",e.datos.cartera&&e.datos.cartera.cantidad_ventas_pendientes>0)}}function Se(r,o){r&1&&(i(0,"div",63)(1,"div",64),n(2,"Cargando reporte..."),t()())}var Z=class r{fb=w(H);reportesSrv=w(K);loading=!1;errorMsg="";errorFecha="";datos=null;vistaVentasPorDia="con-ventas";form=this.fb.group({periodo:["mensual"],fecha_inicio:[null],fecha_fin:[null]});periodos=[{value:"hoy",label:"Hoy"},{value:"semanal",label:"\xDAltimos 7 d\xEDas"},{value:"mensual",label:"Mes actual"},{value:"anual",label:"A\xF1o actual"},{value:"personalizado",label:"Rango personalizado"}];ngOnInit(){this.cargarReporte()}formatearFecha(o){try{let e=new Date(o),l=String(e.getDate()).padStart(2,"0"),d=String(e.getMonth()+1).padStart(2,"0"),c=e.getFullYear();return`${l}/${d}/${c}`}catch{return o}}onPeriodoChange(){this.form.get("periodo")?.value==="personalizado"?(this.form.get("fecha_inicio")?.setValidators([I.required]),this.form.get("fecha_fin")?.setValidators([I.required,this.validarFechaFin.bind(this)])):(this.form.get("fecha_inicio")?.clearValidators(),this.form.get("fecha_fin")?.clearValidators(),this.form.get("fecha_inicio")?.setValue(null),this.form.get("fecha_fin")?.setValue(null),this.errorFecha=""),this.form.get("fecha_inicio")?.updateValueAndValidity(),this.form.get("fecha_fin")?.updateValueAndValidity()}validarFechaFin(o){let e=o.value,l=this.form.get("fecha_inicio")?.value;if(!e||!l)return null;let d=new Date(e),c=new Date(l);return d<c?{fechaAnterior:!0}:null}onFechaChange(){let o=this.form.get("fecha_inicio")?.value,e=this.form.get("fecha_fin")?.value;if(o&&e){let l=new Date(o);new Date(e)<l?(this.errorFecha="La fecha fin no puede ser anterior a la fecha inicio",this.form.get("fecha_fin")?.setErrors({fechaAnterior:!0})):(this.errorFecha="",this.form.get("fecha_fin")?.setErrors(null),this.form.get("fecha_fin")?.updateValueAndValidity())}else this.errorFecha=""}cargarReporte(){if(this.form.get("periodo")?.value==="personalizado"){let l=this.form.get("fecha_inicio")?.value,d=this.form.get("fecha_fin")?.value;if(!l||!d){this.errorFecha="Debe seleccionar ambas fechas";return}let c=new Date(l);if(new Date(d)<c){this.errorFecha="La fecha fin no puede ser anterior a la fecha inicio";return}}this.errorFecha="",this.loading=!0,this.errorMsg="",this.datos=null;let o=this.form.value,e={};o.periodo&&o.periodo!=="personalizado"?e.periodo=o.periodo:o.fecha_inicio&&o.fecha_fin&&(e.fecha_inicio=o.fecha_inicio,e.fecha_fin=o.fecha_fin),this.reportesSrv.reporteVentas(e).subscribe({next:l=>{this.datos=l,this.loading=!1},error:l=>{console.error("Error al cargar reporte:",l),this.errorMsg=l.error?.message||"Error al cargar el reporte de ventas",this.loading=!1}})}get ventasPorDiaFiltradas(){return this.datos?this.vistaVentasPorDia==="con-ventas"?this.datos.por_dia.filter(o=>o.cantidad>0||o.total>0):this.datos.por_dia:[]}exportarAExcel(){if(!this.datos){this.errorMsg="No hay datos para exportar";return}let o=_.book_new(),e=[["REPORTE DE VENTAS"],[""],["Per\xEDodo:",this.datos.periodo.tipo],["Fecha Inicio:",this.formatearFecha(this.datos.periodo.fecha_inicio)],["Fecha Fin:",this.formatearFecha(this.datos.periodo.fecha_fin)],["D\xEDas:",this.datos.periodo.dias],[""],["RESUMEN GENERAL"],["Total Ventas:",this.datos.resumen.total_ventas],["Cantidad de Ventas:",this.datos.resumen.cantidad_ventas],["Venta Promedio:",this.datos.resumen.venta_promedio],[""],["VENTAS CONTADO"],["Cantidad:",this.datos.resumen.ventas_contado],["Total:",this.datos.resumen.total_contado],[""],["VENTAS FIADAS"],["Cantidad:",this.datos.resumen.ventas_fiadas],["Total:",this.datos.resumen.total_fiado]],l=_.aoa_to_sheet(e);_.book_append_sheet(o,l,"Resumen");let d=[["Fecha","Cantidad","Total"],...this.ventasPorDiaFiltradas.map(u=>[this.formatearFecha(u.fecha),u.cantidad,u.total])],c=_.aoa_to_sheet(d);_.book_append_sheet(o,c,"Ventas por D\xEDa");let p=[["Producto","Unidades","Total"],...this.datos.productos_mas_vendidos.map(u=>[u.nombre,u.unidades,u.total])],ee=_.aoa_to_sheet(p);_.book_append_sheet(o,ee,"Productos M\xE1s Vendidos");let te=[["Vendedor","Cantidad Ventas","Total Vendido"],...this.datos.vendedores.map(u=>[u.nombre,u.ventas,u.total])],ie=_.aoa_to_sheet(te);if(_.book_append_sheet(o,ie,"Ventas por Vendedor"),this.datos.cartera&&this.datos.cartera.cantidad_ventas_pendientes>0){let u=[["CARTERA - DEUDAS PENDIENTES"],[""],["Total por Cobrar:",this.datos.cartera.total_por_cobrar],["Cantidad de Ventas Pendientes:",this.datos.cartera.cantidad_ventas_pendientes],[""],["Folio","Fecha","Cliente","Total Venta","Pagado","Saldo Pendiente","Vendedor"],...this.datos.cartera.ventas_pendientes.map(V=>[V.folio||"N/A",this.formatearFecha(V.fecha),V.cliente||"Sin cliente",V.total,V.pagado,V.saldo_pendiente,V.vendedor])],re=_.aoa_to_sheet(u);_.book_append_sheet(o,re,"Cartera")}let ne=this.datos.periodo.fecha_inicio.replace(/-/g,""),ae=this.datos.periodo.fecha_fin.replace(/-/g,""),oe=`Reporte_Ventas_${ne}_${ae}.xlsx`;Q(o,oe)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["app-reporte-ventas"]],decls:13,vars:7,consts:[[1,"space-y-6"],[1,"text-2xl","font-bold","text-center"],["class","mx-auto w-full max-w-6xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-6xl","rounded-2xl","bg-surface-800","border","border-white/5","p-6"],[1,"text-lg","font-semibold","text-brand-500","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],["class","flex flex-col items-center gap-4",4,"ngIf"],["class","grid gap-4 md:grid-cols-2 lg:grid-cols-4",4,"ngIf"],["class","space-y-6",4,"ngIf"],["class","text-center py-12",4,"ngIf"],[1,"mx-auto","w-full","max-w-6xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center"],[1,"flex","flex-col","items-center","gap-4"],[1,"w-full","max-w-md"],[1,"block","text-sm","mb-2"],["formControlName","periodo",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-2","outline-none","focus:border-brand-500",3,"change"],[3,"value",4,"ngFor","ngForOf"],[1,"w-full","max-w-md","flex","gap-2"],["type","submit",1,"flex-1","rounded-xl","bg-brand-500","text-black","font-semibold","px-4","py-2","hover:bg-brand-600","transition","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],["type","button",1,"flex-1","rounded-xl","bg-brand-500","text-black","font-semibold","px-4","py-2","hover:bg-brand-600","transition","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[3,"value"],[1,"grid","gap-4","md:grid-cols-2","lg:grid-cols-4"],["type","date","formControlName","fecha_inicio",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-2","outline-none","focus:border-brand-500",3,"change"],["type","date","formControlName","fecha_fin",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-2","outline-none","focus:border-brand-500",3,"change","min"],[1,"flex","items-end","gap-2"],[1,"rounded-xl","bg-surface-900","border","border-white/5","p-4"],[1,"text-sm","text-textc-mute"],[1,"text-2xl","font-bold","text-brand-500"],[1,"text-2xl","font-bold"],[1,"text-lg","font-semibold"],[1,"mt-6","grid","gap-4","md:grid-cols-2","lg:grid-cols-4"],[1,"text-xl","font-bold"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-brand-500"],[1,"flex","items-center","gap-2"],[1,"rounded-lg","bg-surface-900","border","border-white/10","px-3","py-1","text-sm","outline-none","focus:border-brand-500",3,"ngModelChange","ngModel"],["value","con-ventas"],["value","todas"],["class","text-center py-8 text-textc-mute",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],[1,"overflow-x-auto"],[1,"w-full","table-fixed"],[1,"w-1/3"],[1,"border-b","border-white/10"],[1,"text-left","py-3","px-4","text-sm","font-semibold"],[1,"text-center","py-3","px-4","text-sm","font-semibold",2,"text-align","center"],["class","border-b border-white/5 hover:bg-surface-900/50",4,"ngFor","ngForOf"],["class","mx-auto w-full max-w-6xl rounded-2xl bg-surface-800 border border-white/5 p-6",4,"ngIf"],[1,"text-center","py-8","text-textc-mute"],[1,"border-b","border-white/5","hover:bg-surface-900/50"],[1,"py-3","px-4"],[1,"py-3","px-4","text-center",2,"text-align","center"],[1,"py-3","px-4","text-center","font-semibold",2,"text-align","center"],[1,"mb-4","grid","gap-4","md:grid-cols-2"],[1,"text-2xl","font-bold","text-yellow-400"],[1,"w-full","text-left","text-sm"],[1,"bg-surface-900/60"],[1,"border-b","border-white/5"],[1,"px-4","py-3"],["class","border-b border-white/5",4,"ngFor","ngForOf"],[1,"px-4","py-3","font-medium"],[1,"px-4","py-3","text-green-400"],[1,"px-4","py-3","text-yellow-400","font-semibold"],[1,"px-4","py-3","text-textc-mute"],[1,"text-center","py-12"],[1,"text-textc-mute"]],template:function(e,l){if(e&1&&(i(0,"div",0)(1,"h2",1),n(2,"Reporte de Ventas"),t(),h(3,le,2,1,"div",2)(4,de,2,1,"div",2),i(5,"section",3)(6,"h3",4),n(7,"Filtros"),t(),i(8,"form",5),E("ngSubmit",function(){return l.cargarReporte()}),h(9,ce,11,4,"div",6)(10,pe,19,9,"div",7),t()(),h(11,be,91,23,"div",8)(12,Se,3,0,"div",9),t()),e&2){let d,c;a(3),s("ngIf",l.errorMsg),a(),s("ngIf",l.errorFecha),a(4),s("formGroup",l.form),a(),s("ngIf",((d=l.form.get("periodo"))==null?null:d.value)!=="personalizado"),a(),s("ngIf",((c=l.form.get("periodo"))==null?null:c.value)==="personalizado"),a(),s("ngIf",l.datos&&!l.loading),a(),s("ngIf",l.loading)}},dependencies:[M,N,O,J,G,j,q,L,W,k,B,z,U,Y,$,X],encapsulation:2})};export{Z as ReporteVentas};
