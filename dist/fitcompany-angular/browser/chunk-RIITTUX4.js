import{a as O,b as w,c as x}from"./chunk-OLAEHZKR.js";import"./chunk-Y5NMKK7J.js";import{Ca as I,Ga as _,Mb as M,Nb as P,Qb as T,R as y,Sa as l,Sb as C,Ta as e,Ua as t,Za as f,_a as b,db as R,eb as i,fb as m,gb as d,sb as v,ta as o,vb as u}from"./chunk-4VXNIXON.js";function N(a,r){if(a&1&&(e(0,"div",8),i(1),t()),a&2){let n=b();o(),d(" ",n.errorMsg," ")}}function F(a,r){if(a&1&&(e(0,"div",34)(1,"div",13),i(2,"Por Encima del Stock M\xE1ximo"),t(),e(3,"div",35),i(4),t()()),a&2){let n=b(2);o(4),d(" ",n.datos.inventario.productos_sobre_maximo," ")}}function B(a,r){if(a&1&&(e(0,"div",36)(1,"div",13),i(2,"Bajo del Stock M\xEDnimo"),t(),e(3,"div",37),i(4),t()()),a&2){let n=b(2);o(4),d(" ",n.datos.inventario.productos_bajo_minimo," ")}}function V(a,r){if(a&1&&(e(0,"tr",40)(1,"td",41),i(2),t(),e(3,"td",42),i(4),t(),e(5,"td",43),i(6),t(),e(7,"td",44),i(8),t()()),a&2){let n=r.$implicit;o(2),m(n.nombre),o(2),m(n.stock_actual),o(2),m(n.stock_maximo),o(2),d(" ",n.exceso," ")}}function j(a,r){if(a&1&&(e(0,"div",38)(1,"h4",39),i(2," Productos por Encima del Stock M\xE1ximo "),t(),e(3,"div",25)(4,"table",26)(5,"thead")(6,"tr",27)(7,"th",28),i(8,"Producto"),t(),e(9,"th",29),i(10,"Stock Actual"),t(),e(11,"th",29),i(12,"Stock M\xE1ximo"),t(),e(13,"th",29),i(14,"Exceso"),t()()(),e(15,"tbody"),_(16,V,9,4,"tr",30),t()()()()),a&2){let n=b(2);o(16),l("ngForOf",n.datos.inventario.productos_sobre_maximo_lista)}}function $(a,r){if(a&1&&(e(0,"tr",40)(1,"td",41),i(2),t(),e(3,"td",46),i(4),t(),e(5,"td",43),i(6),t(),e(7,"td",47),i(8),t()()),a&2){let n=r.$implicit;o(2),m(n.nombre),o(2),m(n.stock_actual),o(2),m(n.stock_minimo),o(2),d(" ",n.faltante," ")}}function H(a,r){if(a&1&&(e(0,"div")(1,"h4",45),i(2," Productos Bajo del Stock M\xEDnimo "),t(),e(3,"div",25)(4,"table",26)(5,"thead")(6,"tr",27)(7,"th",28),i(8,"Producto"),t(),e(9,"th",29),i(10,"Stock Actual"),t(),e(11,"th",29),i(12,"Stock M\xEDnimo"),t(),e(13,"th",29),i(14,"Faltante"),t()()(),e(15,"tbody"),_(16,$,9,4,"tr",30),t()()()()),a&2){let n=b(2);o(16),l("ngForOf",n.datos.inventario.productos_bajo_minimo_lista)}}function U(a,r){if(a&1&&(e(0,"tr",40)(1,"td",41),i(2),t(),e(3,"td",43),i(4),t(),e(5,"td",48),i(6),v(7,"currency"),t()()),a&2){let n=r.$implicit;o(2),m(n.nombre),o(2),m(n.unidades),o(2),d(" ",u(7,3,n.total,"COP","symbol-narrow","1.0-0")," ")}}function G(a,r){if(a&1&&(e(0,"div",49)(1,"div",13),i(2,"Producto"),t(),e(3,"div",50),i(4),t(),e(5,"div",13),i(6,"Ganancia Total"),t(),e(7,"div",51),i(8),v(9,"currency"),t()()),a&2){let n=b(2);o(4),d(" ",n.datos.producto_mas_rentable.nombre," "),o(4),d(" ",u(9,2,n.datos.producto_mas_rentable.ganancia,"COP","symbol-narrow","1.0-0")," ")}}function Y(a,r){a&1&&(e(0,"div",52),i(1," No hay datos disponibles "),t())}function K(a,r){if(a&1&&(e(0,"div",0)(1,"section",9)(2,"h3",10),i(3,"Resumen de Hoy"),t(),e(4,"div",11)(5,"div",12)(6,"div",13),i(7,"Ventas de Hoy"),t(),e(8,"div",14),i(9),t(),e(10,"div",15),i(11),v(12,"currency"),t()(),e(13,"div",12)(14,"div",13),i(15,"Compras de Hoy"),t(),e(16,"div",14),i(17),t(),e(18,"div",15),i(19),v(20,"currency"),t()()()(),e(21,"section",9)(22,"h3",10),i(23,"Resumen del Mes"),t(),e(24,"div",16)(25,"div",12)(26,"div",13),i(27,"Ventas del Mes"),t(),e(28,"div",14),i(29),t(),e(30,"div",15),i(31),v(32,"currency"),t()(),e(33,"div",12)(34,"div",13),i(35,"Compras del Mes"),t(),e(36,"div",14),i(37),t(),e(38,"div",15),i(39),v(40,"currency"),t()(),e(41,"div",12)(42,"div",13),i(43,"Ganancia Neta"),t(),e(44,"div",14),i(45),v(46,"currency"),t()()()(),e(47,"section",9)(48,"h3",10),i(49,"Estado del Inventario"),t(),e(50,"div",17)(51,"div",12)(52,"div",13),i(53,"Total Productos"),t(),e(54,"div",2),i(55),t()(),_(56,F,5,1,"div",18)(57,B,5,1,"div",19),e(58,"div",12)(59,"div",13),i(60,"Valor Total Inventario"),t(),e(61,"div",20),i(62),v(63,"currency"),t()()(),_(64,j,17,1,"div",21)(65,H,17,1,"div",22),t(),e(66,"section",9)(67,"h3",10),i(68,"Cartera (Ventas Fiadas)"),t(),e(69,"div",11)(70,"div",12)(71,"div",13),i(72,"Ventas Pendientes"),t(),e(73,"div",14),i(74),t()(),e(75,"div",12)(76,"div",13),i(77,"Total por Cobrar"),t(),e(78,"div",20),i(79),v(80,"currency"),t()()()(),e(81,"section",9)(82,"h3",10),i(83,"Productos Destacados"),t(),e(84,"div",23)(85,"div")(86,"h4",24),i(87,"Top 5 Productos M\xE1s Vendidos del Mes"),t(),e(88,"div",25)(89,"table",26)(90,"thead")(91,"tr",27)(92,"th",28),i(93,"Producto"),t(),e(94,"th",29),i(95,"Unidades"),t(),e(96,"th",29),i(97,"Total"),t()()(),e(98,"tbody"),_(99,U,8,8,"tr",30),t()()()(),e(100,"div")(101,"h4",24),i(102,"Producto M\xE1s Rentable del Mes"),t(),_(103,G,10,7,"div",31)(104,Y,2,0,"div",32),t()()(),e(105,"div",33),i(106),t()()),a&2){let n=b();o(9),m(n.datos.resumen_hoy.ventas.cantidad),o(2),d(" ",u(12,25,n.datos.resumen_hoy.ventas.total,"COP","symbol-narrow","1.0-0")," "),o(6),m(n.datos.resumen_hoy.compras.cantidad),o(2),d(" ",u(20,30,n.datos.resumen_hoy.compras.total,"COP","symbol-narrow","1.0-0")," "),o(10),m(n.datos.resumen_mes.ventas.cantidad),o(2),d(" ",u(32,35,n.datos.resumen_mes.ventas.total,"COP","symbol-narrow","1.0-0")," "),o(6),m(n.datos.resumen_mes.compras.cantidad),o(2),d(" ",u(40,40,n.datos.resumen_mes.compras.total,"COP","symbol-narrow","1.0-0")," "),o(5),R("text-brand-500",n.datos.resumen_mes.ganancia_neta>=0)("text-red-500",n.datos.resumen_mes.ganancia_neta<0),o(),d(" ",u(46,45,n.datos.resumen_mes.ganancia_neta,"COP","symbol-narrow","1.0-0")," "),o(10),m(n.datos.inventario.total_productos),o(),l("ngIf",n.datos.inventario.productos_sobre_maximo>0),o(),l("ngIf",n.datos.inventario.productos_bajo_minimo>0),o(5),d(" ",u(63,50,n.datos.inventario.valor_total,"COP","symbol-narrow","1.0-0")," "),o(2),l("ngIf",n.datos.inventario.productos_sobre_maximo_lista.length>0),o(),l("ngIf",n.datos.inventario.productos_bajo_minimo_lista.length>0),o(9),m(n.datos.cartera.ventas_pendientes),o(5),d(" ",u(80,55,n.datos.cartera.total_por_cobrar,"COP","symbol-narrow","1.0-0")," "),o(20),l("ngForOf",n.datos.top_5_productos),o(4),l("ngIf",n.datos.producto_mas_rentable),o(),l("ngIf",!n.datos.producto_mas_rentable),o(2),d(" Reporte generado el ",n.formatearFecha(n.datos.fecha_generacion)," ")}}function z(a,r){a&1&&(e(0,"div",53)(1,"div",54),i(2,"Cargando reporte..."),t()())}var D=class a{reportesSrv=y(O);loading=!1;errorMsg="";datos=null;ngOnInit(){this.cargarReporte()}cargarReporte(){this.loading=!0,this.errorMsg="",this.datos=null,this.reportesSrv.dashboard().subscribe({next:r=>{this.datos=r,this.loading=!1},error:r=>{console.error("Error al cargar reporte:",r),this.errorMsg=r.error?.message||"Error al cargar el reporte de inventario",this.loading=!1}})}formatearFecha(r){try{let n=new Date(r),s=String(n.getDate()).padStart(2,"0"),c=String(n.getMonth()+1).padStart(2,"0"),S=n.getFullYear(),h=String(n.getHours()).padStart(2,"0"),g=String(n.getMinutes()).padStart(2,"0");return`${s}/${c}/${S} ${h}:${g}`}catch{return r}}formatearFechaCorta(r){try{let n=new Date(r),s=String(n.getDate()).padStart(2,"0"),c=String(n.getMonth()+1).padStart(2,"0"),S=n.getFullYear();return`${s}/${c}/${S}`}catch{return r}}exportarAExcel(){if(!this.datos){this.errorMsg="No hay datos para exportar";return}let r=x.book_new(),n=[["REPORTE DE INVENTARIO Y DASHBOARD"],[""],["Fecha de Generaci\xF3n:",this.formatearFecha(this.datos.fecha_generacion)],[""],["RESUMEN DE HOY"],["Ventas de Hoy:",this.datos.resumen_hoy.ventas.cantidad,this.datos.resumen_hoy.ventas.total],["Compras de Hoy:",this.datos.resumen_hoy.compras.cantidad,this.datos.resumen_hoy.compras.total],[""],["RESUMEN DEL MES"],["Ventas del Mes:",this.datos.resumen_mes.ventas.cantidad,this.datos.resumen_mes.ventas.total],["Compras del Mes:",this.datos.resumen_mes.compras.cantidad,this.datos.resumen_mes.compras.total],["Ganancia Neta:","",this.datos.resumen_mes.ganancia_neta]],s=x.aoa_to_sheet(n);x.book_append_sheet(r,s,"Resumen");let c=[["ESTADO DEL INVENTARIO"],[""],["Total Productos:",this.datos.inventario.total_productos],["Productos por Encima del Stock M\xE1ximo:",this.datos.inventario.productos_sobre_maximo],["Productos Bajo del Stock M\xEDnimo:",this.datos.inventario.productos_bajo_minimo],["Valor Total Inventario:",this.datos.inventario.valor_total],[""]];this.datos.inventario.productos_sobre_maximo_lista.length>0&&(c.push(["PRODUCTOS POR ENCIMA DEL STOCK M\xC1XIMO"]),c.push(["Producto","Stock Actual","Stock M\xE1ximo","Exceso"]),c.push(...this.datos.inventario.productos_sobre_maximo_lista.map(p=>[p.nombre,p.stock_actual,p.stock_maximo,p.exceso])),c.push([""])),this.datos.inventario.productos_bajo_minimo_lista.length>0&&(c.push(["PRODUCTOS BAJO DEL STOCK M\xCDNIMO"]),c.push(["Producto","Stock Actual","Stock M\xEDnimo","Faltante"]),c.push(...this.datos.inventario.productos_bajo_minimo_lista.map(p=>[p.nombre,p.stock_actual,p.stock_minimo,p.faltante])));let S=x.aoa_to_sheet(c);x.book_append_sheet(r,S,"Inventario");let h=[["CARTERA (VENTAS FIADAS)"],[""],["Ventas Pendientes:",this.datos.cartera.ventas_pendientes],["Total por Cobrar:",this.datos.cartera.total_por_cobrar]],g=x.aoa_to_sheet(h);x.book_append_sheet(r,g,"Cartera");let k=[["TOP 5 PRODUCTOS M\xC1S VENDIDOS DEL MES"],[""],["Producto","Unidades","Total"],...this.datos.top_5_productos.map(p=>[p.nombre,p.unidades,p.total])],X=x.aoa_to_sheet(k);x.book_append_sheet(r,X,"Top Productos");let E=[["PRODUCTO M\xC1S RENTABLE DEL MES"],[""]];this.datos.producto_mas_rentable?E.push(["Producto:",this.datos.producto_mas_rentable.nombre],["Ganancia Total:",String(this.datos.producto_mas_rentable.ganancia)]):E.push(["No hay datos disponibles"]);let A=x.aoa_to_sheet(E);x.book_append_sheet(r,A,"Producto Rentable");let L=`Reporte_Inventario_${new Date().toISOString().split("T")[0].replace(/-/g,"")}.xlsx`;w(r,L)}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=I({type:a,selectors:[["app-reporte-inventario"]],decls:12,vars:6,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold"],[1,"flex","gap-2"],[1,"rounded-xl","bg-brand-500","text-black","font-semibold","px-4","py-2","hover:bg-brand-600","transition","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","mx-auto w-full max-w-6xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center",4,"ngIf"],["class","space-y-6",4,"ngIf"],["class","text-center py-12",4,"ngIf"],[1,"mx-auto","w-full","max-w-6xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center"],[1,"mx-auto","w-full","max-w-6xl","rounded-2xl","bg-surface-800","border","border-white/5","p-6"],[1,"text-lg","font-semibold","text-brand-500","mb-4"],[1,"grid","gap-4","md:grid-cols-2"],[1,"rounded-xl","bg-surface-900","border","border-white/5","p-4"],[1,"text-sm","text-textc-mute"],[1,"text-xl","font-bold"],[1,"text-lg","text-brand-500"],[1,"grid","gap-4","md:grid-cols-2","lg:grid-cols-3"],[1,"grid","gap-4","md:grid-cols-2","lg:grid-cols-4","mb-6"],["class","rounded-xl bg-surface-900 border border-red-500/30 p-4",4,"ngIf"],["class","rounded-xl bg-surface-900 border border-yellow-500/30 p-4",4,"ngIf"],[1,"text-xl","font-bold","text-brand-500"],["class","mb-6",4,"ngIf"],[4,"ngIf"],[1,"grid","gap-6","md:grid-cols-2"],[1,"text-md","font-semibold","mb-3"],[1,"overflow-x-auto"],[1,"w-full"],[1,"border-b","border-white/10"],[1,"text-left","py-3","px-4","text-sm","font-semibold"],[1,"text-right","py-3","px-4","text-sm","font-semibold"],["class","border-b border-white/5 hover:bg-surface-900/50",4,"ngFor","ngForOf"],["class","rounded-xl bg-surface-900 border border-brand-500/30 p-4",4,"ngIf"],["class","rounded-xl bg-surface-900 border border-white/5 p-4 text-center text-textc-mute",4,"ngIf"],[1,"text-center","text-sm","text-textc-mute"],[1,"rounded-xl","bg-surface-900","border","border-red-500/30","p-4"],[1,"text-2xl","font-bold","text-red-500"],[1,"rounded-xl","bg-surface-900","border","border-yellow-500/30","p-4"],[1,"text-2xl","font-bold","text-yellow-500"],[1,"mb-6"],[1,"text-md","font-semibold","mb-3","text-red-500"],[1,"border-b","border-white/5","hover:bg-surface-900/50"],[1,"py-3","px-4"],[1,"py-3","px-4","text-right","text-red-500"],[1,"py-3","px-4","text-right"],[1,"py-3","px-4","text-right","font-semibold","text-red-500"],[1,"text-md","font-semibold","mb-3","text-yellow-500"],[1,"py-3","px-4","text-right","text-yellow-500"],[1,"py-3","px-4","text-right","font-semibold","text-yellow-500"],[1,"py-3","px-4","text-right","font-semibold"],[1,"rounded-xl","bg-surface-900","border","border-brand-500/30","p-4"],[1,"text-xl","font-bold","text-brand-500","mb-3"],[1,"text-2xl","font-bold","text-brand-500"],[1,"rounded-xl","bg-surface-900","border","border-white/5","p-4","text-center","text-textc-mute"],[1,"text-center","py-12"],[1,"text-textc-mute"]],template:function(n,s){n&1&&(e(0,"div",0)(1,"div",1)(2,"h2",2),i(3,"Reporte de Inventario"),t(),e(4,"div",3)(5,"button",4),f("click",function(){return s.cargarReporte()}),i(6),t(),e(7,"button",4),f("click",function(){return s.exportarAExcel()}),i(8," Exportar Excel "),t()()(),_(9,N,2,1,"div",5)(10,K,107,60,"div",6)(11,z,3,0,"div",7),t()),n&2&&(o(5),l("disabled",s.loading),o(),d(" ",s.loading?"Cargando...":"Actualizar"," "),o(),l("disabled",!s.datos||s.loading),o(2),l("ngIf",s.errorMsg),o(),l("ngIf",s.datos&&!s.loading),o(),l("ngIf",s.loading))},dependencies:[C,M,P,T],encapsulation:2})};export{D as ReporteInventario};
