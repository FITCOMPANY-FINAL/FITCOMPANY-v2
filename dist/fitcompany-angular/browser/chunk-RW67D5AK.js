import{c as F}from"./chunk-BMDPQX4J.js";import{a as M}from"./chunk-UGXZ4BV2.js";import{a as T}from"./chunk-ODDEEUQE.js";import{a as H}from"./chunk-QEMDHJXP.js";import"./chunk-Y5NMKK7J.js";import{Ca as y,Ga as u,Lb as I,Mb as O,Nb as A,R as v,Sa as l,Sb as k,Ta as r,Ua as i,X as _,Y as S,Ya as C,Za as E,_a as x,eb as o,fb as d,gb as g,hb as D,rb as w,ta as a}from"./chunk-4VXNIXON.js";var P=(n,t,e)=>[n,t,e];function $(n,t){n&1&&(r(0,"div",22)(1,"p",23),o(2,"No hay actividades a\xFAn"),i()())}function N(n,t){if(n&1&&(r(0,"div",26)(1,"span",27),o(2),i(),r(3,"div",28)(4,"p",29),o(5),i(),r(6,"p",30),o(7),i()()()),n&2){let e=t.$implicit;a(2),d(e.icono),a(3),d(e.descripcion),a(2),d(e.fecha)}}function R(n,t){if(n&1&&(r(0,"div",24),u(1,N,8,3,"div",25),i()),n&2){let e=x(2);a(),l("ngForOf",e.actividades.slice(0,5))}}function B(n,t){if(n&1&&(r(0,"div",2)(1,"header")(2,"h1",3),o(3,"Panel de Control"),i(),r(4,"p",4),o(5),i()(),r(6,"section",5)(7,"div",6)(8,"div",7)(9,"div")(10,"p",8),o(11,"Productos"),i(),r(12,"p",9),o(13),i(),r(14,"p",10),o(15,"En cat\xE1logo"),i()(),r(16,"span",11),o(17,"\u{1F4E6}"),i()()(),r(18,"div",12)(19,"div",7)(20,"div")(21,"p",8),o(22,"Compras"),i(),r(23,"p",13),o(24),i(),r(25,"p",10)(26,"span",14),o(27),i(),o(28," registradas hoy "),i()(),r(29,"span",11),o(30,"\u{1F6D2}"),i()()(),r(31,"div",15)(32,"div",7)(33,"div")(34,"p",8),o(35,"Ventas"),i(),r(36,"p",16),o(37),i(),r(38,"p",10)(39,"span",17),o(40),i(),o(41," registradas hoy "),i()(),r(42,"span",11),o(43,"\u{1F4B0}"),i()()()(),r(44,"section",18)(45,"h2",19),o(46,"Actividades Recientes"),i(),u(47,$,3,0,"div",20)(48,R,2,1,"div",21),i()()),n&2){let e=x();a(5),g("Bienvenido, ",e.nombreUsuario),a(8),d(e.totalProductos),a(11),d(e.totalCompras),a(3),d(e.comprasHoy),a(10),d(e.totalVentas),a(3),d(e.ventasHoy),a(7),l("ngIf",e.actividades.length===0),a(),l("ngIf",e.actividades.length>0)}}function j(n,t){if(n&1){let e=C();r(0,"button",45),E("click",function(){let c=_(e).$implicit,m=x(3);return S(m.navegarAModulo(c.ruta))}),o(1),i()}if(n&2){let e=t.$implicit;l("ngClass",w(3,P,e.borderColor,e.bgColor,e.textColor)),a(),D(" ",e.icono," ",e.label," ")}}function J(n,t){if(n&1&&(r(0,"section",18)(1,"h2",19),o(2,"M\xF3dulos"),i(),r(3,"div",43),u(4,j,2,7,"button",44),i()()),n&2){let e=x(2);a(3),l("ngClass",e.modulosDisponibles.length<=2?"grid-cols-1 sm:grid-cols-2":"grid-cols-1 sm:grid-cols-2 lg:grid-cols-4"),a(),l("ngForOf",e.modulosDisponibles)}}function L(n,t){if(n&1&&(r(0,"div",26)(1,"span",27),o(2),i(),r(3,"div",28)(4,"p",29),o(5),i(),r(6,"p",30),o(7),i()()()),n&2){let e=t.$implicit;a(2),d(e.icono),a(3),d(e.descripcion),a(2),d(e.fecha)}}function Y(n,t){if(n&1&&(r(0,"section",18)(1,"h2",19),o(2,"Actividades Recientes"),i(),r(3,"div",24),u(4,L,8,3,"div",25),i()()),n&2){let e=x(2);a(4),l("ngForOf",e.actividades.slice(0,3))}}function q(n,t){if(n&1&&(r(0,"div",2)(1,"header",22)(2,"h1",31),o(3),i(),r(4,"p",32),o(5,"Accede a los m\xF3dulos disponibles"),i()(),r(6,"section",33)(7,"div",34)(8,"p",35),o(9,"\u{1F4E6}"),i(),r(10,"p",36),o(11,"Productos"),i(),r(12,"p",37),o(13),i()(),r(14,"div",38)(15,"p",35),o(16,"\u{1F6D2}"),i(),r(17,"p",36),o(18,"Compras hoy"),i(),r(19,"p",39),o(20),i()(),r(21,"div",40)(22,"p",35),o(23,"\u{1F4B0}"),i(),r(24,"p",36),o(25,"Ventas hoy"),i(),r(26,"p",41),o(27),i()()(),u(28,J,5,2,"section",42)(29,Y,5,1,"section",42),i()),n&2){let e=x();a(3),g("\xA1Hola, ",e.nombreUsuario,"!"),a(10),d(e.totalProductos),a(7),d(e.comprasHoy),a(7),d(e.ventasHoy),a(),l("ngIf",e.modulosDisponibles.length>0),a(),l("ngIf",e.actividades.length>0)}}var V=class n{comprasSrv=v(M);ventasSrv=v(T);productosSrv=v(H);router=v(F);esAdmin=!1;nombreUsuario="";cargando=!0;totalProductos=0;totalCompras=0;totalVentas=0;comprasHoy=0;ventasHoy=0;actividades=[];modulosDisponibles=[];modulosMap={compras:{label:"Compras",icono:"\u{1F6D2}",ruta:"/dashboard/compras",color:"brand",borderColor:"border-brand-500/30",bgColor:"bg-brand-500/5",textColor:"text-brand-300"},ventas:{label:"Ventas",icono:"\u{1F4B0}",ruta:"/dashboard/ventas",color:"emerald",borderColor:"border-emerald-500/30",bgColor:"bg-emerald-500/5",textColor:"text-emerald-300"},productos:{label:"Productos",icono:"\u{1F4E6}",ruta:"/dashboard/productos",color:"blue",borderColor:"border-blue-500/30",bgColor:"bg-blue-500/5",textColor:"text-blue-300"},categorias:{label:"Categor\xEDas",icono:"\u{1F3F7}\uFE0F",ruta:"/dashboard/categorias",color:"purple",borderColor:"border-purple-500/30",bgColor:"bg-purple-500/5",textColor:"text-purple-300"},usuarios:{label:"Usuarios",icono:"\u{1F465}",ruta:"/dashboard/usuarios",color:"pink",borderColor:"border-pink-500/30",bgColor:"bg-pink-500/5",textColor:"text-pink-300"},roles:{label:"Roles",icono:"\u{1F510}",ruta:"/dashboard/roles",color:"red",borderColor:"border-red-500/30",bgColor:"bg-red-500/5",textColor:"text-red-300"}};ngOnInit(){this.detectarRol(),this.cargarModulosDisponibles(),this.cargarDatos()}cargarModulosDisponibles(){try{let t=localStorage.getItem("token");if(!t){this.modulosDisponibles=[];return}let e=t.split(".");if(e.length!==3){this.modulosDisponibles=[];return}let c=JSON.parse(atob(e[1])).formularios||[],m=[];c.forEach(p=>{let b=(p.titulo_formulario||p.titulo||p.label||"").toLowerCase().trim();for(let[f,h]of Object.entries(this.modulosMap))if(b.includes(f)||b===f){m.find(U=>U.ruta===h.ruta)||m.push(h);break}}),this.modulosDisponibles=m.slice(0,4),console.log("Formularios encontrados:",c.map(p=>p.titulo_formulario)),console.log("M\xF3dulos disponibles:",this.modulosDisponibles.map(p=>p.label))}catch(t){console.error("Error cargando m\xF3dulos disponibles:",t),this.modulosDisponibles=[]}}detectarRol(){try{let t=localStorage.getItem("token");if(!t){this.esAdmin=!1,this.nombreUsuario="Usuario";return}let e=t.split(".");if(e.length!==3){this.esAdmin=!1,this.nombreUsuario="Usuario";return}let s=JSON.parse(atob(e[1]));this.nombreUsuario=s.nombre_usuario||s.user||"Usuario",this.esAdmin=s.rol==="admin"||s.id_rol===1}catch(t){console.error("Error decodificando token:",t),this.esAdmin=!1,this.nombreUsuario="Usuario"}}cargarDatos(){this.cargando=!0,this.productosSrv.listar().subscribe({next:t=>{this.totalProductos=t?.length||0},error:t=>{console.error("Error cargando productos:",t),this.totalProductos=0}}),this.comprasSrv.listar().subscribe({next:t=>{this.totalCompras=t?.length||0,this.comprasHoy=this.contarTransaccionesHoy(t,"fecha_compra"),this.agregarActividadesCompras(t),this.cargando=!1},error:t=>{console.error("Error cargando compras:",t),this.totalCompras=0,this.cargando=!1}}),this.ventasSrv.listar().subscribe({next:t=>{this.totalVentas=t?.length||0,this.ventasHoy=this.contarTransaccionesHoy(t,"fecha"),this.agregarActividadesVentas(t),this.cargando=!1},error:t=>{console.error("Error cargando ventas:",t),this.totalVentas=0,this.cargando=!1}})}contarTransaccionesHoy(t,e){if(!t||t.length===0)return 0;let s=new Date().toDateString();return t.filter(c=>{try{let m=c[e];return new Date(m).toDateString()===s}catch{return!1}}).length}agregarActividadesCompras(t){!t||t.length===0||(t.slice(0,3).forEach(e=>{this.actividades.push({tipo:"compra",descripcion:`Se registr\xF3 una compra (ID: ${e.id_compra})`,fecha:this.formatearFecha(e.fecha_compra),icono:"\u{1F6D2}"})}),this.ordenarActividades())}agregarActividadesVentas(t){!t||t.length===0||(t.slice(0,3).forEach(e=>{this.actividades.push({tipo:"venta",descripcion:`Se registr\xF3 una venta (ID: ${e.id_venta})`,fecha:this.formatearFecha(e.fecha),icono:"\u{1F4B0}"})}),this.ordenarActividades())}ordenarActividades(){this.actividades.sort((t,e)=>{try{let s=new Date(t.fecha).getTime();return new Date(e.fecha).getTime()-s}catch{return 0}})}formatearFecha(t){if(!t)return"";try{let e=new Date(t),s=String(e.getDate()).padStart(2,"0"),c=String(e.getMonth()+1).padStart(2,"0"),m=e.getFullYear(),p=String(e.getHours()).padStart(2,"0"),b=String(e.getMinutes()).padStart(2,"0");return`${s}/${c}/${m} ${p}:${b}`}catch{return t}}navegarAModulo(t){this.router.navigate([t])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-overview"]],decls:3,vars:2,consts:[[1,"space-y-8","pb-8"],["class","space-y-8",4,"ngIf"],[1,"space-y-8"],[1,"text-3xl","font-bold","text-brand-500"],[1,"text-sm","text-textc-mute","mt-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4","sm:gap-6"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","p-6","hover:border-brand-500/30","transition"],[1,"flex","items-start","justify-between"],[1,"text-xs","text-textc-mute","uppercase","tracking-wide","font-semibold"],[1,"text-4xl","font-extrabold","text-brand-500","mt-3"],[1,"text-xs","text-textc-mute","mt-2"],[1,"text-3xl","opacity-30"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","p-6","hover:border-orange-500/30","transition"],[1,"text-4xl","font-extrabold","text-orange-400","mt-3"],[1,"text-orange-300","font-semibold"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","p-6","hover:border-emerald-500/30","transition"],[1,"text-4xl","font-extrabold","text-emerald-400","mt-3"],[1,"text-emerald-300","font-semibold"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","p-6"],[1,"text-lg","font-semibold","text-brand-500","mb-5"],["class","text-center py-8",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"text-center","py-8"],[1,"text-sm","text-textc-mute"],[1,"space-y-4"],["class","flex items-start gap-4 pb-4 border-b border-white/5 last:border-0",4,"ngFor","ngForOf"],[1,"flex","items-start","gap-4","pb-4","border-b","border-white/5","last:border-0"],[1,"text-2xl","flex-shrink-0"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-textc-mute","mt-1"],[1,"text-3xl","font-bold","text-brand-500","mb-2"],[1,"text-textc-mute"],[1,"grid","grid-cols-1","sm:grid-cols-3","gap-4","sm:gap-6"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","p-6","text-center","hover:border-brand-500/30","transition"],[1,"text-3xl","mb-3"],[1,"text-xs","text-textc-mute","uppercase","tracking-wide","mb-2"],[1,"text-3xl","font-extrabold","text-brand-500"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","p-6","text-center","hover:border-orange-500/30","transition"],[1,"text-3xl","font-extrabold","text-orange-400"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","p-6","text-center","hover:border-emerald-500/30","transition"],[1,"text-3xl","font-extrabold","text-emerald-400"],["class","rounded-2xl bg-surface-800 border border-white/5 p-6",4,"ngIf"],[1,"grid","gap-3",3,"ngClass"],["class","text-left px-5 py-4 rounded-xl border hover:border-opacity-100 transition font-medium",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"text-left","px-5","py-4","rounded-xl","border","hover:border-opacity-100","transition","font-medium",3,"click","ngClass"]],template:function(e,s){e&1&&(r(0,"div",0),u(1,B,49,8,"div",1)(2,q,30,6,"div",1),i()),e&2&&(a(),l("ngIf",s.esAdmin),a(),l("ngIf",!s.esAdmin))},dependencies:[k,I,O,A],encapsulation:2})};export{V as Overview};
