import{b as H,c as u,d as R,e as z,g as G,h as W,k as J,l as K,m as Q,n as X,p as Y,r as Z}from"./chunk-R2MBKBQG.js";import{a as j}from"./chunk-Y5NMKK7J.js";import{B as A,Ca as V,Ga as f,Mb as $,Nb as q,Qb as B,R as y,Sa as c,Sb as L,Ta as i,Ua as o,Va as S,X as x,Y as g,Ya as I,Yb as U,Za as m,_a as p,a as D,b as N,db as O,eb as n,fb as P,gb as b,ib as F,sb as C,ta as l,vb as T}from"./chunk-4VXNIXON.js";function te(d,e){if(d&1&&(i(0,"div",32),n(1),o()),d&2){let t=p();l(),b(" ",t.okMsg," ")}}function ie(d,e){if(d&1&&(i(0,"div",33),n(1),o()),d&2){let t=p();l(),b(" ",t.errorMsg," ")}}function oe(d,e){if(d&1&&(i(0,"div",34),n(1),o()),d&2){let t=p();l(),b(" ",t.errorMsgInline," ")}}function re(d,e){if(d&1&&(i(0,"option",35),n(1),o()),d&2){let t=e.$implicit;c("value",t.codigo_unidad_medida),l(),b(" ",t.nombre_unidad_medida," ")}}function ne(d,e){if(d&1&&(i(0,"option",35),n(1),o()),d&2){let t=e.$implicit;c("value",t.id_categoria),l(),b(" ",t.nombre_categoria," ")}}function ae(d,e){if(d&1){let t=I();i(0,"button",36),m("click",function(){x(t);let s=p();return g(s.cancelarEdicion())}),n(1," Cancelar "),o()}}function se(d,e){d&1&&(i(0,"div",37),n(1,"Cargando\u2026"),o())}function le(d,e){d&1&&(i(0,"div",37),n(1,"No hay registros"),o())}function de(d,e){if(d&1){let t=I();i(0,"tr",41)(1,"td",42),n(2),o(),i(3,"td",42),n(4),C(5,"currency"),o(),i(6,"td",42),n(7),C(8,"currency"),o(),i(9,"td",42),n(10),o(),i(11,"td",42),n(12),o(),i(13,"td",42),n(14),o(),i(15,"td",44)(16,"button",45),m("click",function(){let s=x(t).$implicit,a=p(2);return g(a.editar(s))}),n(17,"Editar"),o(),i(18,"button",46),m("click",function(){let s=x(t).$implicit,a=p(2);return g(a.confirmarEliminar(s.id_producto))}),n(19," Eliminar "),o()()()}if(d&2){let t=e.$implicit,r=p(2);l(),O("text-red-400",r.isOutOfRange(t))("font-semibold",r.isOutOfRange(t)),l(),b(" ",t.nombre_producto," "),l(2),b(" ",T(5,12,t.precio_costo,"COP","symbol-narrow","1.0-0")," "),l(3),b(" ",T(8,17,t.precio_unitario,"COP","symbol-narrow","1.0-0")," "),l(3),F(" ",t.stock_actual," (min: ",t.stock_minimo,", max: ",t.stock_maximo,") "),l(2),P(t.nombre_unidad_medida),l(2),P(t.nombre_categoria)}}function ce(d,e){if(d&1&&(i(0,"div",38)(1,"table",39)(2,"thead",40)(3,"tr",41)(4,"th",42),n(5,"Nombre"),o(),i(6,"th",42),n(7,"Precio compra"),o(),i(8,"th",42),n(9,"Precio venta"),o(),i(10,"th",42),n(11,"Stock"),o(),i(12,"th",42),n(13,"Unidad"),o(),i(14,"th",42),n(15,"Categor\xEDa"),o(),i(16,"th",42),n(17,"Acciones"),o()()(),i(18,"tbody"),f(19,de,20,22,"tr",43),o()()()),d&2){let t=p();l(19),c("ngForOf",t.rows)}}function ue(d,e){if(d&1){let t=I();i(0,"div",47),S(1,"div",48),i(2,"div",49)(3,"h3",50),n(4,"Confirmar eliminaci\xF3n"),o(),i(5,"p",51),n(6,"\xBFSeguro que deseas eliminar este producto?"),o(),i(7,"div",52)(8,"button",53),m("click",function(){x(t);let s=p();return g(s.closeConfirm())}),n(9," Cancelar "),o(),i(10,"button",54),m("click",function(){x(t);let s=p();return g(s.doEliminarConfirmado())}),n(11," Aceptar "),o()(),i(12,"button",55),m("click",function(){x(t);let s=p();return g(s.closeConfirm())}),n(13,"\u2715"),o()()()}}var ee=class d{fb=y(Y);http=y(U);API=j.apiBaseUrl;rows=[];unidades=[];categorias=[];loadingList=!1;saving=!1;okMsg="";errorMsg="";errorMsgInline="";editando=!1;editId=null;confirmOpen=!1;pendingDeleteId=null;precioMasked="";precioCostoMasked="";stockActualMasked="";stockMinimoMasked="";stockMaximoMasked="";form=this.fb.nonNullable.group({nombre_producto:["",[u.required,u.maxLength(120)]],descripcion_producto:["",[u.maxLength(255)]],precio_costo:[null,[u.required,u.min(0),u.max(99999999)]],precio_unitario:[null,[u.required,u.min(1),u.max(99999999)]],stock_actual:[null,[u.required,u.min(0)]],stock_minimo:[null,[u.required,u.min(0)]],stock_maximo:[null,[u.required,u.min(1)]],unidad_medida:["",[u.required]],producto_categoria:["",[u.required]]});ngOnInit(){this.loadCombos(),this.loadData()}autoHide(e=4e3){window.setTimeout(()=>{this.okMsg="",this.errorMsg="",this.errorMsgInline=""},e)}showOk(e){this.okMsg=e,this.errorMsg="",this.errorMsgInline="",this.autoHide()}showError(e){this.errorMsg=e,this.okMsg="",this.errorMsgInline="",this.autoHide()}showInline(e){this.errorMsgInline=e,this.okMsg="",this.errorMsg="",this.autoHide()}onlyDigits(e){return(e||"").replace(/\D/g,"")}clampDigits(e,t){return this.onlyDigits(e).slice(0,t)}withThousands(e){return e.replace(/\B(?=(\d{3})+(?!\d))/g,".")}onBeforeInputDigits(e,t,r){let s=e.inputType||"";if(s.startsWith("delete")||s==="historyUndo"||s==="historyRedo")return;let a=e.target,_=e.data??"",v=a.selectionStart??a.value.length,k=a.selectionEnd??a.value.length,w=(a.value||"").replace(/\D/g,""),M=(a.value.slice(0,v)||"").replace(/\D/g,""),h=(a.value.slice(k)||"").replace(/\D/g,""),E=(String(_)||"").replace(/\D/g,"");M.length+E.length+h.length>r&&e.preventDefault()}onInputMasked(e,t,r){let s=r.target,a=this.clampDigits(s.value,t),_=this.withThousands(a);e==="precio_costo"?(this.precioCostoMasked=_,this.form.controls.precio_costo.setValue(a?Number(a):null),this.form.controls.precio_costo.markAsTouched()):e==="precio_unitario"?(this.precioMasked=_,this.form.controls.precio_unitario.setValue(a?Number(a):null),this.form.controls.precio_unitario.markAsTouched()):e==="stock_actual"?(this.stockActualMasked=_,this.form.controls.stock_actual.setValue(a?Number(a):null),this.form.controls.stock_actual.markAsTouched()):e==="stock_minimo"?(this.stockMinimoMasked=_,this.form.controls.stock_minimo.setValue(a?Number(a):null),this.form.controls.stock_minimo.markAsTouched()):(this.stockMaximoMasked=_,this.form.controls.stock_maximo.setValue(a?Number(a):null),this.form.controls.stock_maximo.markAsTouched()),this.errorMsgInline=""}loadCombos(){this.http.get(`${this.API}/unidades-medida`).subscribe({next:e=>this.unidades=e||[],error:()=>this.unidades=[]}),this.http.get(`${this.API}/categorias`).subscribe({next:e=>this.categorias=e||[],error:()=>this.categorias=[]})}loadData(){this.loadingList=!0,this.http.get(`${this.API}/productos`).subscribe({next:e=>{this.rows=(e||[]).map(t=>N(D({},t),{precio_costo:Math.floor(t.precio_costo||0),precio_unitario:Math.floor(t.precio_venta||0),stock_actual:Math.floor(t.stock_actual||0),stock_minimo:Math.floor(t.stock_minimo||0),stock_maximo:Math.floor(t.stock_maximo||0),unidad_medida:t.id_unidad_medida||0,producto_categoria:t.id_categoria||0})),this.loadingList=!1},error:e=>{console.error("Error al cargar productos:",e),this.rows=[],this.loadingList=!1,this.showError("Error al cargar los productos.")}})}stocksValid(){let e=Number(this.form.value.stock_actual??0),t=Number(this.form.value.stock_minimo??0),r=Number(this.form.value.stock_maximo??0);return!Number.isFinite(r)||r<=0?"El stock m\xE1ximo debe ser mayor a cero.":!Number.isFinite(e)||!Number.isFinite(t)?"Stock actual y m\xEDnimo deben ser n\xFAmeros v\xE1lidos.":e<t?"El stock actual no puede ser menor que el stock m\xEDnimo.":e>r?"El stock actual no puede ser mayor que el stock m\xE1ximo.":null}isOutOfRange(e){let t=Number(e.stock_actual??0),r=Number(e.stock_minimo??0),s=Number(e.stock_maximo??0);return t<r||s>0&&t>s}submit(){if(this.saving)return;if(!this.form.value.nombre_producto)return this.showInline("El nombre es obligatorio.");let e=this.form.value.precio_costo??null,t=this.form.value.precio_unitario??null;if(e===null||e<0||e>99999999)return this.showInline("El precio de compra debe estar entre 0 y 99.999.999.");if(!t||t<1||t>99999999)return this.showInline("El precio de venta debe estar entre 1 y 99.999.999.");if(t<e)return this.showInline("El precio de venta no puede ser menor que el precio de compra.");if(!this.form.value.unidad_medida)return this.showInline("Debes seleccionar la unidad de medida.");if(!this.form.value.producto_categoria)return this.showInline("Debes seleccionar la categor\xEDa.");let r=this.stocksValid();if(r)return this.showInline(r);this.saving=!0,this.okMsg="",this.errorMsg="",this.errorMsgInline="";let s=Math.floor(e||0),a=Math.floor(t||0),_=Math.floor(Number(this.form.value.stock_actual)||0),v=Math.floor(Number(this.form.value.stock_minimo)||0),k=Math.floor(Number(this.form.value.stock_maximo)||0),w={nombre_producto:(this.form.value.nombre_producto||"").trim().replace(/\s+/g," "),descripcion_producto:(this.form.value.descripcion_producto||"").trim().replace(/\s+/g," "),precio_costo:s,precio_unitario:a,precio_venta:a,stock_actual:_,stock_minimo:v,stock_maximo:k,id_unidad_medida:Number(this.form.value.unidad_medida),unidad_medida:Number(this.form.value.unidad_medida),id_categoria:Number(this.form.value.producto_categoria),producto_categoria:Number(this.form.value.producto_categoria)};(this.editando&&this.editId!=null?this.http.put(`${this.API}/productos/${this.editId}`,w):this.http.post(`${this.API}/productos`,w)).pipe(A(()=>{this.saving=!1})).subscribe({next:h=>{this.showOk(h?.message||(this.editando?"Producto actualizado.":"Producto creado.")),this.loadData(),this.resetForm(),window.scrollTo({top:0,behavior:"smooth"})},error:h=>{let E=h?.error?.message||"Error al guardar producto.";h?.status===400||h?.status===409?this.showInline(E):this.showError(E)}})}editar(e){this.editando=!0,this.editId=e.id_producto??null;let t=e.precio_costo??0,r=e.precio_unitario??e.precio_venta??0,s=e.unidad_medida??e.id_unidad_medida??0,a=e.producto_categoria??e.id_categoria??0;this.form.patchValue({nombre_producto:e.nombre_producto??"",descripcion_producto:e.descripcion_producto??"",precio_costo:t,precio_unitario:r,stock_actual:e.stock_actual??null,stock_minimo:e.stock_minimo??null,stock_maximo:e.stock_maximo??null,unidad_medida:String(s),producto_categoria:String(a)});let _=Math.floor(t||0),v=Math.floor(r||0),k=Math.floor(e.stock_actual??0),w=Math.floor(e.stock_minimo??0),M=Math.floor(e.stock_maximo??0);this.precioCostoMasked=this.withThousands(String(_)),this.precioMasked=this.withThousands(String(v)),this.stockActualMasked=this.withThousands(String(k)),this.stockMinimoMasked=this.withThousands(String(w)),this.stockMaximoMasked=this.withThousands(String(M)),window.scrollTo({top:0,behavior:"smooth"})}cancelarEdicion(){this.resetForm()}confirmarEliminar(e){this.pendingDeleteId=e??null,this.confirmOpen=!0}closeConfirm(){this.confirmOpen=!1,this.pendingDeleteId=null}doEliminarConfirmado(){if(this.pendingDeleteId==null){this.closeConfirm();return}let e=this.pendingDeleteId;this.closeConfirm(),this.http.delete(`${this.API}/productos/${e}`).subscribe({next:t=>{this.showOk(t?.message||"Producto eliminado correctamente."),this.loadData()},error:t=>{this.showError(t?.error?.message||"No se pudo eliminar el producto.")}})}resetForm(){this.editando=!1,this.editId=null,this.form.reset({nombre_producto:"",descripcion_producto:"",precio_costo:null,precio_unitario:null,stock_actual:null,stock_minimo:null,stock_maximo:null,unidad_medida:"",producto_categoria:""}),this.precioCostoMasked="",this.precioMasked="",this.stockActualMasked="",this.stockMinimoMasked="",this.stockMaximoMasked=""}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=V({type:d,selectors:[["app-productos"]],decls:87,vars:19,consts:[[1,"space-y-6"],[1,"text-center","text-xl","font-bold"],["class","mx-auto w-full max-w-3xl rounded-xl border border-green-500/40 bg-green-500/10 px-4 py-3 text-green-300 text-center",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center whitespace-pre-line",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-2xl","bg-surface-800","border","border-white/5","p-6","sm:p-7"],[1,"text-lg","font-semibold","text-brand-500","mb-4"],["novalidate","",1,"space-y-5",3,"ngSubmit","formGroup"],[1,"block","text-sm","mb-1"],[1,"text-brand-500"],["type","text","formControlName","nombre_producto","placeholder","Ej: Prote\xEDna Bi Pro","autocomplete","off",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500"],["type","text","formControlName","descripcion_producto","placeholder","Breve descripci\xF3n del producto",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500"],[1,"grid","gap-4","sm:grid-cols-2"],["type","text","inputmode","numeric","placeholder","$0",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500",3,"beforeinput","input","value"],[1,"mt-1","text-xs","text-textc-mute"],[1,"grid","gap-4","sm:grid-cols-3"],["type","text","inputmode","numeric","placeholder","0",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500",3,"beforeinput","input","value"],["type","text","inputmode","numeric","placeholder","Ej: 5",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500",3,"beforeinput","input","value"],["type","text","inputmode","numeric","placeholder","Ej: 20",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500",3,"beforeinput","input","value"],["formControlName","unidad_medida",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","producto_categoria",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500"],[1,"flex","gap-3"],["type","submit",1,"flex-1","rounded-xl","border-2","border-dashed","border-brand-500/70","text-brand-500","font-semibold","py-3","hover:bg-brand-500","hover:text-black","transition","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-brand-500",3,"disabled"],["type","button","class","px-4 rounded-xl border border-white/10 hover:bg-white/5 transition",3,"click",4,"ngIf"],[1,"mx-auto","w-full","max-w-5xl"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","overflow-hidden"],[1,"px-6","py-4","border-b","border-white/5","font-semibold"],["class","px-6 py-10 text-center text-textc-mute",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","fixed inset-0 z-[60] flex items-center justify-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-green-500/40","bg-green-500/10","px-4","py-3","text-green-300","text-center"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center","whitespace-pre-line"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center"],[3,"value"],["type","button",1,"px-4","rounded-xl","border","border-white/10","hover:bg-white/5","transition",3,"click"],[1,"px-6","py-10","text-center","text-textc-mute"],[1,"overflow-x-auto"],[1,"w-full","text-left","text-sm"],[1,"bg-surface-900/60"],[1,"border-b","border-white/5"],[1,"px-6","py-3"],["class","border-b border-white/5",4,"ngFor","ngForOf"],[1,"px-6","py-3","whitespace-nowrap"],["type","button",1,"text-brand-500","hover:text-brand-600","mr-3",3,"click"],["type","button",1,"text-red-400","hover:text-red-300",3,"click"],[1,"fixed","inset-0","z-[60]","flex","items-center","justify-center"],[1,"absolute","inset-0","bg-black/60"],[1,"relative","z-[61]","w-full","max-w-md","rounded-2xl","bg-surface-800","border","border-white/10","p-6","shadow-xl"],[1,"text-lg","font-semibold","mb-2"],[1,"text-sm","text-textc-mute"],[1,"mt-6","flex","gap-3","justify-end"],["type","button",1,"rounded-xl","border","border-white/10","px-4","py-2","hover:bg-white/5",3,"click"],["type","button",1,"rounded-xl","bg-brand-500","text-black","font-semibold","px-4","py-2","hover:bg-brand-600",3,"click"],["type","button","aria-label","Cerrar",1,"absolute","right-3","top-3","text-textc-mute","hover:text-white",3,"click"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"h2",1),n(2,"Gesti\xF3n de Productos"),o(),f(3,te,2,1,"div",2)(4,ie,2,1,"div",3)(5,oe,2,1,"div",4),i(6,"section",5)(7,"h3",6),n(8),o(),i(9,"form",7),m("ngSubmit",function(){return r.submit()}),i(10,"div")(11,"label",8),n(12,"Nombre "),i(13,"span",9),n(14,"*"),o()(),S(15,"input",10),o(),i(16,"div")(17,"label",8),n(18,"Descripci\xF3n"),o(),S(19,"input",11),o(),i(20,"div",12)(21,"div")(22,"label",8),n(23,"Precio de compra "),i(24,"span",9),n(25,"*"),o()(),i(26,"input",13),m("beforeinput",function(a){return r.onBeforeInputDigits(a,"precio_costo",8)})("input",function(a){return r.onInputMasked("precio_costo",8,a)}),o(),i(27,"p",14),n(28,"M\xE1ximo 99.999.999"),o()(),i(29,"div")(30,"label",8),n(31,"Precio de venta "),i(32,"span",9),n(33,"*"),o()(),i(34,"input",13),m("beforeinput",function(a){return r.onBeforeInputDigits(a,"precio_unitario",8)})("input",function(a){return r.onInputMasked("precio_unitario",8,a)}),o(),i(35,"p",14),n(36,"M\xE1ximo 99.999.999"),o()()(),i(37,"div",15)(38,"div")(39,"label",8),n(40,"Stock actual "),i(41,"span",9),n(42,"*"),o()(),i(43,"input",16),m("beforeinput",function(a){return r.onBeforeInputDigits(a,"stock_actual",9)})("input",function(a){return r.onInputMasked("stock_actual",9,a)}),o()(),i(44,"div")(45,"label",8),n(46,"Stock m\xEDnimo "),i(47,"span",9),n(48,"*"),o()(),i(49,"input",17),m("beforeinput",function(a){return r.onBeforeInputDigits(a,"stock_minimo",9)})("input",function(a){return r.onInputMasked("stock_minimo",9,a)}),o()(),i(50,"div")(51,"label",8),n(52,"Stock m\xE1ximo "),i(53,"span",9),n(54,"*"),o()(),i(55,"input",18),m("beforeinput",function(a){return r.onBeforeInputDigits(a,"stock_maximo",9)})("input",function(a){return r.onInputMasked("stock_maximo",9,a)}),o()()(),i(56,"div",12)(57,"div")(58,"label",8),n(59,"Unidad de medida "),i(60,"span",9),n(61,"*"),o()(),i(62,"select",19)(63,"option",20),n(64,"Seleccione\u2026"),o(),f(65,re,2,2,"option",21),o()(),i(66,"div")(67,"label",8),n(68,"Categor\xEDa "),i(69,"span",9),n(70,"*"),o()(),i(71,"select",22)(72,"option",20),n(73,"Seleccione\u2026"),o(),f(74,ne,2,2,"option",21),o()()(),i(75,"div",23)(76,"button",24),n(77),o(),f(78,ae,2,0,"button",25),o()()(),i(79,"section",26)(80,"div",27)(81,"div",28),n(82,"Lista de productos"),o(),f(83,se,2,0,"div",29)(84,le,2,0,"div",29)(85,ce,20,1,"div",30),o()(),f(86,ue,14,0,"div",31),o()),t&2&&(l(3),c("ngIf",r.okMsg),l(),c("ngIf",r.errorMsg),l(),c("ngIf",r.errorMsgInline),l(3),b(" ",r.editando?"Editar producto":"Agregar producto"," "),l(),c("formGroup",r.form),l(17),c("value",r.precioCostoMasked),l(8),c("value",r.precioMasked),l(9),c("value",r.stockActualMasked),l(6),c("value",r.stockMinimoMasked),l(6),c("value",r.stockMaximoMasked),l(10),c("ngForOf",r.unidades),l(9),c("ngForOf",r.categorias),l(2),c("disabled",r.saving),l(),b(" ",r.saving?"Guardando\u2026":r.editando?"Actualizar":"Agregar"," "),l(),c("ngIf",r.editando),l(5),c("ngIf",r.loadingList),l(),c("ngIf",!r.loadingList&&r.rows.length===0),l(),c("ngIf",!r.loadingList&&r.rows.length>0),l(),c("ngIf",r.confirmOpen))},dependencies:[L,$,q,Z,G,Q,X,H,K,R,z,W,J,B],encapsulation:2})};export{ee as Productos};
