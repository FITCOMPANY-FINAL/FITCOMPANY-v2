import{b as V,c as g,d as R,e as D,g as O,h as X,k as $,p as B,r as L}from"./chunk-R2MBKBQG.js";import{a as N}from"./chunk-Y5NMKK7J.js";import{B as I,Ca as y,Ga as p,Mb as C,Nb as U,Pa as v,R as M,Sa as l,Sb as T,Ta as n,Ua as r,Va as S,X as b,Y as _,Ya as E,Yb as k,Za as u,_a as m,db as A,eb as d,fb as h,gb as f,ta as o}from"./chunk-4VXNIXON.js";function P(a,i){if(a&1&&(n(0,"div",24),d(1),r()),a&2){let e=m();o(),f(" ",e.okMsg," ")}}function H(a,i){if(a&1&&(n(0,"div",25),d(1),r()),a&2){let e=m();o(),f(" ",e.errorMsg," ")}}function j(a,i){if(a&1&&(n(0,"div",26),d(1),r()),a&2){let e=m();o(),f(" ",e.errorMsgInline," ")}}function G(a,i){if(a&1&&(n(0,"span",27),d(1),r()),a&2){let e=m();o(),f(" M\xE1ximo ",e.NOMBRE_MAX," caracteres. ")}}function z(a,i){if(a&1&&(n(0,"span",27),d(1),r()),a&2){let e=m();o(),h(e.nombreError)}}function q(a,i){if(a&1&&(n(0,"span",27),d(1),r()),a&2){let e=m();o(),f(" M\xE1ximo ",e.ABREV_MAX," caracteres. ")}}function K(a,i){if(a&1&&(n(0,"span",27),d(1),r()),a&2){let e=m();o(),f(" M\xE1ximo ",e.DESC_MAX," caracteres. ")}}function Z(a,i){if(a&1){let e=E();n(0,"button",28),u("click",function(){b(e);let s=m();return _(s.cancelarEdicion())}),d(1," Cancelar "),r()}}function J(a,i){a&1&&(n(0,"div",29),d(1," Cargando\u2026 "),r())}function Q(a,i){a&1&&(n(0,"div",29),d(1," No hay registros "),r())}function W(a,i){a&1&&(n(0,"span",41),d(1,"Activa"),r())}function Y(a,i){a&1&&(n(0,"span",42),d(1,"Inactiva"),r())}function ee(a,i){if(a&1){let e=E();n(0,"tr",33)(1,"td",34),d(2),r(),n(3,"td",34),d(4),r(),n(5,"td",34),d(6),r(),n(7,"td",34),p(8,W,2,0,"span",36)(9,Y,2,0,"span",37),r(),n(10,"td",38)(11,"button",39),u("click",function(){let s=b(e).$implicit,c=m(2);return _(c.editar(s))}),d(12,"Editar"),r(),n(13,"button",40),u("click",function(){let s=b(e).$implicit,c=m(2);return _(c.confirmarEliminar(s))}),d(14,"Eliminar"),r()()()}if(a&2){let e=i.$implicit;A("opacity-60",e.estado==="I"),o(2),h(e.nombre_unidad_medida),o(2),h(e.abreviatura_unidad_medida||"\u2014"),o(2),h(e.descripcion_unidad_medida||"\u2014"),o(2),l("ngIf",e.estado==="A"),o(),l("ngIf",e.estado==="I")}}function te(a,i){if(a&1&&(n(0,"div",30)(1,"table",31)(2,"thead",32)(3,"tr",33)(4,"th",34),d(5,"Nombre"),r(),n(6,"th",34),d(7,"Abreviatura"),r(),n(8,"th",34),d(9,"Descripci\xF3n"),r(),n(10,"th",34),d(11,"Estado"),r(),n(12,"th",34),d(13,"Acciones"),r()()(),n(14,"tbody"),p(15,ee,15,7,"tr",35),r()()()),a&2){let e=m();o(15),l("ngForOf",e.rows)}}function ie(a,i){if(a&1){let e=E();n(0,"div",43),S(1,"div",44),n(2,"div",45)(3,"h3",46),d(4),r(),n(5,"p",47),d(6),r(),n(7,"div",48)(8,"button",49),u("click",function(){b(e);let s=m();return _(s.closeConfirm())}),d(9,"Cancelar"),r(),n(10,"button",50),u("click",function(){b(e);let s=m();return _(s.doConfirm())}),d(11,"Aceptar"),r()(),n(12,"button",51),u("click",function(){b(e);let s=m();return _(s.closeConfirm())}),d(13,"\u2715"),r()()()}if(a&2){let e=m();o(4),h(e.confirmTitle),o(2),h(e.confirmMessage)}}var F=class a{fb=M(B);http=M(k);API=N.apiBaseUrl;NOMBRE_MAX=100;ABREV_MAX=10;DESC_MAX=150;PATRON=/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s\-.]+$/;loadingList=!1;saving=!1;okMsg="";errorMsg="";errorMsgInline="";nombreError="";rows=[];editando=!1;editingRow=null;confirmOpen=!1;confirmTitle="";confirmMessage="";confirmHandler=null;form=this.fb.nonNullable.group({nombre:["",[g.required,g.maxLength(this.NOMBRE_MAX)]],abreviatura:["",[g.maxLength(this.ABREV_MAX)]],descripcion:["",[g.maxLength(this.DESC_MAX)]]});ngOnInit(){this.loadData()}autoHide(i=4e3){window.setTimeout(()=>{this.okMsg="",this.errorMsg="",this.errorMsgInline=""},i)}showOk(i){this.okMsg=i,this.errorMsg="",this.errorMsgInline="",this.autoHide()}showError(i){this.errorMsg=i,this.okMsg="",this.errorMsgInline="",this.autoHide()}showInline(i){this.errorMsgInline=i,this.okMsg="",this.errorMsg="",this.autoHide()}onNombreInput(i){let e=i.target,t=e.value.slice(0,this.NOMBRE_MAX);e.value!==t&&(e.value=t,this.form.controls.nombre.setValue(t,{emitEvent:!1})),this.nombreError&&(this.nombreError="")}onAbreviaturaInput(i){let e=i.target,t=e.value.slice(0,this.ABREV_MAX);e.value!==t&&(e.value=t,this.form.controls.abreviatura.setValue(t,{emitEvent:!1}))}onDescInput(i){let e=i.target,t=e.value.slice(0,this.DESC_MAX);e.value!==t&&(e.value=t,this.form.controls.descripcion.setValue(t,{emitEvent:!1}))}loadData(){this.loadingList=!0,this.http.get(`${this.API}/unidades-medida`).subscribe({next:i=>{this.rows=i||[],this.loadingList=!1},error:i=>{console.error("Error al cargar unidades de medida:",i),this.rows=[],this.loadingList=!1,this.showError("Error al cargar las unidades de medida.")}})}submit(){if(this.saving)return;let i=(this.form.value.nombre||"").trim().replace(/\s+/g," "),e=(this.form.value.abreviatura||"").trim().replace(/\s+/g," "),t=(this.form.value.descripcion||"").trim().replace(/\s+/g," ");if(!i)return this.showInline("El nombre es obligatorio.");if(!this.PATRON.test(i))return this.showInline("El nombre solo puede contener letras, espacios, guiones y puntos.");if(i.length>this.NOMBRE_MAX)return this.showInline(`El nombre admite m\xE1ximo ${this.NOMBRE_MAX} caracteres.`);if(e&&e.length>this.ABREV_MAX)return this.showInline(`La abreviatura admite m\xE1ximo ${this.ABREV_MAX} caracteres.`);if(t.length>this.DESC_MAX)return this.showInline(`La descripci\xF3n admite m\xE1ximo ${this.DESC_MAX} caracteres.`);this.saving=!0;let s={nombre_unidad_medida:i,abreviatura_unidad_medida:e||void 0,descripcion_unidad_medida:t||void 0};(this.editando&&this.editingRow?.codigo_unidad_medida?this.http.put(`${this.API}/unidades-medida/${this.editingRow.codigo_unidad_medida}`,s):this.http.post(`${this.API}/unidades-medida`,s)).pipe(I(()=>{this.saving=!1})).subscribe({next:x=>{this.showOk(x?.message||(this.editando?"Unidad actualizada":"Unidad creada")),this.loadData(),this.resetForm(),window.scrollTo({top:0,behavior:"smooth"})},error:x=>{let w=x?.error?.message||"Error al guardar la unidad.";x?.status===400||x?.status===409?this.showInline(w):this.showError(w)}})}editar(i){this.editando=!0,this.editingRow=i,this.form.patchValue({nombre:i.nombre_unidad_medida??"",abreviatura:i.abreviatura_unidad_medida??"",descripcion:i.descripcion_unidad_medida??""}),window.scrollTo({top:0,behavior:"smooth"})}cancelarEdicion(){this.resetForm()}confirmarEliminar(i){this.confirmTitle="Confirmar eliminaci\xF3n",this.confirmMessage=`\xBFSeguro que deseas eliminar la unidad "${i.nombre_unidad_medida}"?
Esta acci\xF3n no se puede deshacer.`,this.confirmHandler=()=>this.eliminar(i.codigo_unidad_medida),this.confirmOpen=!0}closeConfirm(){this.confirmOpen=!1,this.confirmTitle="",this.confirmMessage="",this.confirmHandler=null}doConfirm(){let i=this.confirmHandler;this.closeConfirm(),i&&i()}eliminar(i){if(!i||Number.isNaN(i)){this.showError("ID inv\xE1lido.");return}this.http.delete(`${this.API}/unidades-medida/${i}`).subscribe({next:e=>{this.showOk(e?.message||"Unidad eliminada correctamente."),this.loadData()},error:e=>{let t=e?.error||{};if(e?.status===409&&t?.requiresUpdateProducts){let s=(t.productos||[]).map(x=>`\u2022 ${x}`).join(`
`),c=t.truncated?`

(Se muestran solo algunos; total: ${t.totalProductos})`:"";this.confirmTitle="No se puede eliminar",this.confirmMessage=`La unidad est\xE1 en uso por ${t.totalProductos??0} producto(s).
Debes editar esos productos y cambiar la unidad antes de eliminarla.

${s}${c}`,this.confirmHandler=null,this.confirmOpen=!0;return}this.showError(t?.message||"Error al eliminar.")}})}resetForm(){this.editando=!1,this.editingRow=null,this.form.reset({nombre:"",abreviatura:"",descripcion:""}),this.nombreError=""}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=y({type:a,selectors:[["app-unidades-medidas"]],decls:43,vars:19,consts:[[1,"space-y-6"],[1,"text-center","text-xl","font-bold"],["class","mx-auto w-full max-w-3xl rounded-xl border border-green-500/40 bg-green-500/10 px-4 py-3 text-green-300 text-center",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center whitespace-pre-line",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-2xl","bg-surface-800","border","border-white/5","p-6","sm:p-7"],[1,"text-lg","font-semibold","text-brand-500","mb-4"],["novalidate","",1,"space-y-5",3,"ngSubmit","formGroup"],[1,"block","text-sm","mb-1"],[1,"text-brand-500"],["type","text","formControlName","nombre","autocomplete","off","placeholder","Ej: Kilogramo, Unidad, Gramo",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm",3,"input"],[1,"mt-1","text-xs"],["class","text-red-400",4,"ngIf"],["type","text","formControlName","abreviatura","autocomplete","off","placeholder","Ej: KG, UND, GR",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm",3,"input"],["type","text","formControlName","descripcion","placeholder","Ej: Medida base, peso de alimentos, etc.",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm",3,"input"],[1,"flex","items-center","gap-3"],["type","submit",1,"flex-1","rounded-xl","border-2","border-dashed","border-brand-500/70","text-brand-500","font-semibold","py-3","hover:bg-brand-500","hover:text-black","transition","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-brand-500",3,"disabled"],["type","button","class","px-4 rounded-xl border border-white/10 hover:bg-white/5 transition",3,"click",4,"ngIf"],[1,"mx-auto","w-full","max-w-5xl"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","overflow-hidden"],[1,"px-6","py-4","border-b","border-white/5","font-semibold"],["class","px-6 py-10 text-center text-textc-mute",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","fixed inset-0 z-[60] flex items-center justify-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-green-500/40","bg-green-500/10","px-4","py-3","text-green-300","text-center"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center","whitespace-pre-line"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center"],[1,"text-red-400"],["type","button",1,"px-4","rounded-xl","border","border-white/10","hover:bg-white/5","transition",3,"click"],[1,"px-6","py-10","text-center","text-textc-mute"],[1,"overflow-x-auto"],[1,"w-full","text-left","text-sm"],[1,"bg-surface-900/60"],[1,"border-b","border-white/5"],[1,"px-6","py-3"],["class","border-b border-white/5",3,"opacity-60",4,"ngFor","ngForOf"],["class","text-green-300",4,"ngIf"],["class","text-gray-400",4,"ngIf"],[1,"px-6","py-3","whitespace-nowrap"],["type","button",1,"text-brand-500","hover:text-brand-600","mr-3",3,"click"],["type","button",1,"text-red-400","hover:text-red-300",3,"click"],[1,"text-green-300"],[1,"text-gray-400"],[1,"fixed","inset-0","z-[60]","flex","items-center","justify-center"],[1,"absolute","inset-0","bg-black/60"],[1,"relative","z-[61]","w-full","max-w-md","rounded-2xl","bg-surface-800","border","border-white/10","p-6","shadow-xl"],[1,"text-lg","font-semibold","mb-2"],[1,"text-sm","text-textc-mute","whitespace-pre-line"],[1,"mt-6","flex","gap-3","justify-end"],["type","button",1,"rounded-xl","border","border-white/10","px-4","py-2","hover:bg-white/5",3,"click"],["type","button",1,"rounded-xl","bg-brand-500","text-black","font-semibold","px-4","py-2","hover:bg-brand-600",3,"click"],["type","button","aria-label","Cerrar",1,"absolute","right-3","top-3","text-textc-mute","hover:text-white",3,"click"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"h2",1),d(2,"Gesti\xF3n de Unidades de Medida"),r(),p(3,P,2,1,"div",2)(4,H,2,1,"div",3)(5,j,2,1,"div",4),n(6,"section",5)(7,"h3",6),d(8),r(),n(9,"form",7),u("ngSubmit",function(){return t.submit()}),n(10,"div")(11,"label",8),d(12,"Nombre de la unidad "),n(13,"span",9),d(14,"*"),r()(),n(15,"input",10),u("input",function(c){return t.onNombreInput(c)}),r(),n(16,"div",11),p(17,G,2,1,"span",12)(18,z,2,1,"span",12),r()(),n(19,"div")(20,"label",8),d(21,"Abreviatura (opcional)"),r(),n(22,"input",13),u("input",function(c){return t.onAbreviaturaInput(c)}),r(),n(23,"div",11),p(24,q,2,1,"span",12),r()(),n(25,"div")(26,"label",8),d(27,"Descripci\xF3n (opcional)"),r(),n(28,"input",14),u("input",function(c){return t.onDescInput(c)}),r(),n(29,"div",11),p(30,K,2,1,"span",12),r()(),n(31,"div",15)(32,"button",16),d(33),r(),p(34,Z,2,0,"button",17),r()()(),n(35,"section",18)(36,"div",19)(37,"div",20),d(38,"Lista de unidades de medida"),r(),p(39,J,2,0,"div",21)(40,Q,2,0,"div",21)(41,te,16,1,"div",22),r()(),p(42,ie,14,2,"div",23),r()),e&2&&(o(3),l("ngIf",t.okMsg),o(),l("ngIf",t.errorMsg),o(),l("ngIf",t.errorMsgInline),o(3),f(" ",t.editando?"Editar unidad de medida":"Agregar unidad de medida"," "),o(),l("formGroup",t.form),o(6),v("maxlength",t.NOMBRE_MAX),o(2),l("ngIf",((t.form.controls.nombre.value==null?null:t.form.controls.nombre.value.length)??0)>=t.NOMBRE_MAX),o(),l("ngIf",t.nombreError),o(4),v("maxlength",t.ABREV_MAX),o(2),l("ngIf",((t.form.controls.abreviatura.value==null?null:t.form.controls.abreviatura.value.length)??0)>=t.ABREV_MAX),o(4),v("maxlength",t.DESC_MAX),o(2),l("ngIf",((t.form.controls.descripcion.value==null?null:t.form.controls.descripcion.value.length)??0)>=t.DESC_MAX),o(2),l("disabled",t.saving),o(),f(" ",t.saving?"Guardando\u2026":t.editando?"Actualizar":"Agregar"," "),o(),l("ngIf",t.editando),o(5),l("ngIf",t.loadingList),o(),l("ngIf",!t.loadingList&&t.rows.length===0),o(),l("ngIf",!t.loadingList&&t.rows.length>0),o(),l("ngIf",t.confirmOpen))},dependencies:[T,C,U,L,O,V,R,D,X,$],encapsulation:2})};export{F as UnidadesMedidas};
