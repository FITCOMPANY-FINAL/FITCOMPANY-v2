import{b as F,c as v,d as B,e as L,g as P,h as H,k as z,p as j,r as q}from"./chunk-R2MBKBQG.js";import{a as X}from"./chunk-Y5NMKK7J.js";import{Ca as y,Ga as u,Mb as V,Nb as D,Pa as E,R as I,Sa as d,Sb as O,Ta as n,Ua as r,Va as M,Wa as S,X as x,Xa as A,Xb as R,Y as h,Ya as g,Yb as $,Za as m,_a as c,bb as C,c as T,db as k,eb as a,fb as _,gb as f,ta as s,wb as N}from"./chunk-4VXNIXON.js";function U(o,t){if(o&1&&(n(0,"div",25),a(1),r()),o&2){let e=c();s(),f(" ",e.okMsg," ")}}function Y(o,t){if(o&1&&(n(0,"div",26),a(1),r()),o&2){let e=c();s(),f(" ",e.errorMsg," ")}}function Z(o,t){if(o&1&&(n(0,"div",27),a(1),r()),o&2){let e=c();s(),f(" ",e.errorMsgInline," ")}}function J(o,t){if(o&1&&(n(0,"span",28),a(1),r()),o&2){let e=c();s(),f(" M\xE1ximo ",e.NOMBRE_MAX," caracteres. ")}}function K(o,t){if(o&1&&(n(0,"span",28),a(1),r()),o&2){let e=c();s(),_(e.descError)}}function Q(o,t){if(o&1&&(n(0,"span",28),a(1),r()),o&2){let e=c();s(),f(" M\xE1ximo ",e.ABREV_MAX," caracteres. ")}}function W(o,t){if(o&1&&(n(0,"span",28),a(1),r()),o&2){let e=c();s(),f(" M\xE1ximo ",e.DESC_MAX," caracteres. ")}}function ee(o,t){if(o&1){let e=g();n(0,"button",29),m("click",function(){x(e);let l=c();return h(l.cancelarEdicion())}),a(1," Cancelar "),r()}}function te(o,t){o&1&&(n(0,"div",30),a(1," Cargando\u2026 "),r())}function ie(o,t){o&1&&(n(0,"div",30),a(1," No hay registros "),r())}function ne(o,t){o&1&&(n(0,"span",41),a(1,"Activo"),r())}function re(o,t){o&1&&(n(0,"span",42),a(1,"Inactivo"),r())}function oe(o,t){if(o&1){let e=g();S(0),n(1,"button",43),m("click",function(){x(e);let l=c().$implicit,p=c(2);return h(p.editar(l))}),a(2,"Editar"),r(),n(3,"button",44),m("click",function(){x(e);let l=c().$implicit,p=c(2);return h(p.confirmarEliminar(l))}),a(4,"Eliminar"),r(),A()}}function ae(o,t){if(o&1){let e=g();n(0,"button",45),m("click",function(){x(e);let l=c().$implicit,p=c(2);return h(p.confirmarActivar(l))}),a(1," Activar "),r()}}function se(o,t){if(o&1&&(n(0,"tr",34)(1,"td",35),a(2),r(),n(3,"td",35),a(4),r(),n(5,"td",35),a(6),r(),n(7,"td",35),u(8,ne,2,0,"span",37)(9,re,2,0,"span",38),r(),n(10,"td",39),u(11,oe,5,0,"ng-container",40)(12,ae,2,0,"ng-template",null,0,N),r()()),o&2){let e=t.$implicit,i=C(13);k("opacity-60",e.estado==="I"),s(2),_(e.nombre),s(2),_(e.abreviatura||"\u2014"),s(2),_(e.descripcion||"\u2014"),s(2),d("ngIf",e.estado==="A"),s(),d("ngIf",e.estado==="I"),s(2),d("ngIf",e.estado!=="I")("ngIfElse",i)}}function le(o,t){if(o&1&&(n(0,"div",31)(1,"table",32)(2,"thead",33)(3,"tr",34)(4,"th",35),a(5,"Nombre"),r(),n(6,"th",35),a(7,"Abreviatura"),r(),n(8,"th",35),a(9,"Descripci\xF3n"),r(),n(10,"th",35),a(11,"Estado"),r(),n(12,"th",35),a(13,"Acciones"),r()()(),n(14,"tbody"),u(15,se,14,9,"tr",36),r()()()),o&2){let e=c();s(15),d("ngForOf",e.tipos)}}function ce(o,t){if(o&1){let e=g();n(0,"div",46),M(1,"div",47),n(2,"div",48)(3,"h3",49),a(4),r(),n(5,"p",50),a(6),r(),n(7,"div",51)(8,"button",52),m("click",function(){x(e);let l=c();return h(l.closeConfirm())}),a(9,"Cancelar"),r(),n(10,"button",53),m("click",function(){x(e);let l=c();return h(l.doConfirm())}),a(11,"Aceptar"),r()(),n(12,"button",54),m("click",function(){x(e);let l=c();return h(l.closeConfirm())}),a(13,"\u2715"),r()()()}if(o&2){let e=c();s(4),_(e.confirmTitle),s(2),_(e.confirmMessage)}}var G=class o{fb=I(j);http=I($);API=X.apiBaseUrl;NOMBRE_MAX=50;ABREV_MAX=10;DESC_MAX=200;PATRON=/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s\-.]+$/;loadingList=!1;saving=!1;okMsg="";errorMsg="";errorMsgInline="";descError="";tipos=[];editando=!1;editRow=null;confirmOpen=!1;confirmTitle="";confirmMessage="";confirmHandler=null;form=this.fb.nonNullable.group({nombre:["",[v.required,v.maxLength(this.NOMBRE_MAX)]],abreviatura:["",[v.maxLength(this.ABREV_MAX)]],descripcion:["",[v.maxLength(this.DESC_MAX)]]});ngOnInit(){this.loadData()}autoHide(t=4e3){window.setTimeout(()=>{this.okMsg="",this.errorMsg="",this.errorMsgInline=""},t)}showOk(t){this.okMsg=t,this.errorMsg="",this.errorMsgInline="",this.autoHide()}showError(t){this.errorMsg=t,this.okMsg="",this.errorMsgInline="",this.autoHide()}showInline(t){this.errorMsgInline=t,this.okMsg="",this.errorMsg="",this.autoHide()}canon(t){return(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g," ")}onNombreInput(t){let e=t.target,i=e.value.slice(0,this.NOMBRE_MAX);e.value!==i&&(e.value=i,this.form.controls.nombre.setValue(i,{emitEvent:!1})),this.descError&&(this.descError="")}onAbreviaturaInput(t){let e=t.target,i=e.value.slice(0,this.ABREV_MAX);e.value!==i&&(e.value=i,this.form.controls.abreviatura.setValue(i,{emitEvent:!1}))}onDescripcionInput(t){let e=t.target,i=e.value.slice(0,this.DESC_MAX);e.value!==i&&(e.value=i,this.form.controls.descripcion.setValue(i,{emitEvent:!1}))}loadData(){this.loadingList=!0,this.http.get(`${this.API}/tipos-identificacion`).subscribe({next:t=>{this.tipos=t||[],this.loadingList=!1},error:t=>{console.error("Error al cargar tipos:",t),this.tipos=[],this.loadingList=!1,this.showError("Error al cargar los tipos de identificaci\xF3n.")}})}checkDuplicado(){return T(this,null,function*(){let t=(this.form.value.nombre||"").trim();if(!t){this.descError="Ingresa un tipo de identificaci\xF3n";return}if(!this.PATRON.test(t)){this.descError="Solo letras, espacios, guiones y puntos.";return}try{let e=new R().set("nombre",t);this.editando&&this.editRow?.id&&(e=e.set("excludeId",String(this.editRow.id))),(yield this.http.get(`${this.API}/tipos-identificacion/exists`,{params:e}).toPromise())?.exists?this.descError="Ya existe un tipo de identificaci\xF3n con ese nombre.":this.descError=""}catch{this.descError=""}})}submit(){if(this.saving)return;let t=(this.form.value.nombre||"").trim().replace(/\s+/g," "),e=(this.form.value.abreviatura||"").trim().replace(/\s+/g," "),i=(this.form.value.descripcion||"").trim().replace(/\s+/g," ");if(!t){this.showInline("El nombre es obligatorio.");return}if(!this.PATRON.test(t)){this.showInline("El nombre solo puede contener letras, espacios, guiones y puntos.");return}if(t.length>this.NOMBRE_MAX){this.showInline(`El nombre admite m\xE1ximo ${this.NOMBRE_MAX} caracteres.`);return}if(e&&e.length>this.ABREV_MAX){this.showInline(`La abreviatura admite m\xE1ximo ${this.ABREV_MAX} caracteres.`);return}if(i&&i.length>this.DESC_MAX){this.showInline(`La descripci\xF3n admite m\xE1ximo ${this.DESC_MAX} caracteres.`);return}if(this.descError){this.showInline(this.descError);return}this.saving=!0,this.errorMsgInline="",this.errorMsg="";let l={nombre:t,abreviatura:e||void 0,descripcion:i||void 0};(this.editando&&this.editRow?.id?this.http.put(`${this.API}/tipos-identificacion/${this.editRow.id}`,l):this.http.post(`${this.API}/tipos-identificacion`,l)).subscribe({next:b=>{this.saving=!1,this.showOk(b?.message||(this.editando?"Tipo actualizado":"Tipo agregado")),this.loadData(),this.resetForm(),window.scrollTo({top:0,behavior:"smooth"})},error:b=>{this.saving=!1;let w=b?.error?.message||"Error al guardar.";b?.status===400||b?.status===409?this.showInline(w):this.showError(w)}})}editar(t){this.editando=!0,this.editRow=t,this.form.patchValue({nombre:t.nombre??"",abreviatura:t.abreviatura??"",descripcion:t.descripcion??""}),this.descError="",window.scrollTo({top:0,behavior:"smooth"})}cancelarEdicion(){this.resetForm()}confirmarEliminar(t){this.confirmTitle="Confirmar eliminaci\xF3n",this.confirmMessage=`\xBFSeguro que deseas eliminar "${t.nombre}"?
Esta acci\xF3n no se puede deshacer.`,this.confirmHandler=()=>this.eliminar(t),this.confirmOpen=!0}confirmarActivar(t){this.confirmTitle="Confirmar activaci\xF3n",this.confirmMessage=`Este tipo est\xE1 inactivo.
\xBFDeseas ACTIVAR "${t.descripcion}"?`,this.confirmHandler=()=>this.activar(t.id),this.confirmOpen=!0}closeConfirm(){this.confirmOpen=!1,this.confirmTitle="",this.confirmMessage="",this.confirmHandler=null}doConfirm(){let t=this.confirmHandler;this.closeConfirm(),t&&t()}eliminar(t){this.http.delete(`${this.API}/tipos-identificacion/${t.id}`).subscribe({next:e=>{this.showOk(e?.message||"Eliminado correctamente"),this.loadData()},error:e=>{if(e?.status===409&&e?.error?.requiresDeactivation){let i=Number(e.error.usuarios??0),l=Number(e.error.ventas??0),p=[];i>0&&p.push(`${i} usuario(s)`),l>0&&p.push(`${l} venta(s)`);let b=p.join(" y ")||"registros relacionados";this.confirmTitle="No se puede eliminar",this.confirmMessage=`Este tipo est\xE1 en uso por ${b}.

No se puede eliminar porque est\xE1 siendo utilizado.`,this.confirmHandler=null,this.confirmOpen=!0;return}this.showError(e?.error?.message||"Operaci\xF3n no permitida."),this.loadData()}})}desactivar(t){this.http.patch(`${this.API}/tipos-identificacion/${t}/desactivar`,{}).subscribe({next:e=>{this.showOk(e?.message||"Desactivado correctamente"),this.loadData()},error:e=>{this.showError(e?.error?.message||"No se pudo desactivar.")}})}activar(t){this.http.patch(`${this.API}/tipos-identificacion/${t}/activar`,{}).subscribe({next:e=>{this.showOk(e?.message||"Activado correctamente"),this.loadData()},error:e=>{this.showError(e?.error?.message||"No se pudo activar.")}})}resetForm(){this.editando=!1,this.editRow=null,this.form.reset({nombre:"",abreviatura:"",descripcion:""}),this.descError=""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["app-tipos-identificaciones"]],decls:43,vars:19,consts:[["activarTpl",""],[1,"space-y-6"],[1,"text-center","text-xl","font-bold"],["class","mx-auto w-full max-w-3xl rounded-xl border border-green-500/40 bg-green-500/10 px-4 py-3 text-green-300 text-center",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center whitespace-pre-line",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-2xl","bg-surface-800","border","border-white/5","p-6","sm:p-7"],[1,"text-lg","font-semibold","text-brand-500","mb-4"],["novalidate","",1,"space-y-5",3,"ngSubmit","formGroup"],[1,"block","text-sm","mb-1"],[1,"text-brand-500"],["type","text","formControlName","nombre","autocomplete","off","placeholder","Ej: C\xE9dula de Ciudadan\xEDa",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm",3,"input","blur"],[1,"mt-1","text-xs"],["class","text-red-400",4,"ngIf"],["type","text","formControlName","abreviatura","autocomplete","off","placeholder","Ej: CC",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm",3,"input"],["type","text","formControlName","descripcion","autocomplete","off","placeholder","Descripci\xF3n opcional del tipo de identificaci\xF3n",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm",3,"input"],[1,"flex","items-center","gap-3"],["type","submit",1,"flex-1","rounded-xl","border-2","border-dashed","border-brand-500/70","text-brand-500","font-semibold","py-3","hover:bg-brand-500","hover:text-black","transition","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-brand-500",3,"disabled"],["type","button","class","px-4 rounded-xl border border-white/10 hover:bg-white/5 transition",3,"click",4,"ngIf"],[1,"mx-auto","w-full","max-w-5xl"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","overflow-hidden"],[1,"px-6","py-4","border-b","border-white/5","font-semibold"],["class","px-6 py-10 text-center text-textc-mute",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","fixed inset-0 z-[60] flex items-center justify-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-green-500/40","bg-green-500/10","px-4","py-3","text-green-300","text-center"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center","whitespace-pre-line"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center"],[1,"text-red-400"],["type","button",1,"px-4","rounded-xl","border","border-white/10","hover:bg-white/5","transition",3,"click"],[1,"px-6","py-10","text-center","text-textc-mute"],[1,"overflow-x-auto"],[1,"w-full","text-left","text-sm"],[1,"bg-surface-900/60"],[1,"border-b","border-white/5"],[1,"px-6","py-3"],["class","border-b border-white/5",3,"opacity-60",4,"ngFor","ngForOf"],["class","text-green-300",4,"ngIf"],["class","text-gray-400",4,"ngIf"],[1,"px-6","py-3","whitespace-nowrap"],[4,"ngIf","ngIfElse"],[1,"text-green-300"],[1,"text-gray-400"],["type","button",1,"text-brand-500","hover:text-brand-600","mr-3",3,"click"],["type","button",1,"text-red-400","hover:text-red-300",3,"click"],["type","button",1,"text-cyan-300","hover:text-cyan-200",3,"click"],[1,"fixed","inset-0","z-[60]","flex","items-center","justify-center"],[1,"absolute","inset-0","bg-black/60"],[1,"relative","z-[61]","w-full","max-w-md","rounded-2xl","bg-surface-800","border","border-white/10","p-6","shadow-xl"],[1,"text-lg","font-semibold","mb-2"],[1,"text-sm","text-textc-mute","whitespace-pre-line"],[1,"mt-6","flex","gap-3","justify-end"],["type","button",1,"rounded-xl","border","border-white/10","px-4","py-2","hover:bg-white/5",3,"click"],["type","button",1,"rounded-xl","bg-brand-500","text-black","font-semibold","px-4","py-2","hover:bg-brand-600",3,"click"],["type","button","aria-label","Cerrar",1,"absolute","right-3","top-3","text-textc-mute","hover:text-white",3,"click"]],template:function(e,i){e&1&&(n(0,"div",1)(1,"h2",2),a(2,"Gesti\xF3n de Tipos de Identificaci\xF3n"),r(),u(3,U,2,1,"div",3)(4,Y,2,1,"div",4)(5,Z,2,1,"div",5),n(6,"section",6)(7,"h3",7),a(8),r(),n(9,"form",8),m("ngSubmit",function(){return i.submit()}),n(10,"div")(11,"label",9),a(12,"Nombre "),n(13,"span",10),a(14,"*"),r()(),n(15,"input",11),m("input",function(p){return i.onNombreInput(p)})("blur",function(){return i.checkDuplicado()}),r(),n(16,"div",12),u(17,J,2,1,"span",13)(18,K,2,1,"span",13),r()(),n(19,"div")(20,"label",9),a(21,"Abreviatura"),r(),n(22,"input",14),m("input",function(p){return i.onAbreviaturaInput(p)}),r(),n(23,"div",12),u(24,Q,2,1,"span",13),r()(),n(25,"div")(26,"label",9),a(27,"Descripci\xF3n"),r(),n(28,"input",15),m("input",function(p){return i.onDescripcionInput(p)}),r(),n(29,"div",12),u(30,W,2,1,"span",13),r()(),n(31,"div",16)(32,"button",17),a(33),r(),u(34,ee,2,0,"button",18),r()()(),n(35,"section",19)(36,"div",20)(37,"div",21),a(38,"Listado"),r(),u(39,te,2,0,"div",22)(40,ie,2,0,"div",22)(41,le,16,1,"div",23),r()(),u(42,ce,14,2,"div",24),r()),e&2&&(s(3),d("ngIf",i.okMsg),s(),d("ngIf",i.errorMsg),s(),d("ngIf",i.errorMsgInline),s(3),f(" ",i.editando?"Editar tipo de identificaci\xF3n":"Agregar tipo de identificaci\xF3n"," "),s(),d("formGroup",i.form),s(6),E("maxlength",i.NOMBRE_MAX),s(2),d("ngIf",((i.form.controls.nombre.value==null?null:i.form.controls.nombre.value.length)??0)>=i.NOMBRE_MAX),s(),d("ngIf",i.descError),s(4),E("maxlength",i.ABREV_MAX),s(2),d("ngIf",((i.form.controls.abreviatura.value==null?null:i.form.controls.abreviatura.value.length)??0)>=i.ABREV_MAX),s(4),E("maxlength",i.DESC_MAX),s(2),d("ngIf",((i.form.controls.descripcion.value==null?null:i.form.controls.descripcion.value.length)??0)>=i.DESC_MAX),s(2),d("disabled",i.saving),s(),f(" ",i.saving?"Guardando\u2026":i.editando?"Actualizar":"Agregar"," "),s(),d("ngIf",i.editando),s(5),d("ngIf",i.loadingList),s(),d("ngIf",!i.loadingList&&i.tipos.length===0),s(),d("ngIf",!i.loadingList&&i.tipos.length>0),s(),d("ngIf",i.confirmOpen))},dependencies:[O,V,D,q,P,F,B,L,H,z],styles:["[_nghost-%COMP%]{display:block}"]})};export{G as TiposIdentificaciones};
