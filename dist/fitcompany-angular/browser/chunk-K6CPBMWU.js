import{b as V,c as w,d as F,e as $,g as L,h as P,k as j,p as A,r as z}from"./chunk-R2MBKBQG.js";import{a as O}from"./chunk-Y5NMKK7J.js";import{B as y,Ca as S,Ga as m,M as I,Mb as D,Nb as M,R as x,Sa as d,Sb as T,Ta as r,Ua as i,Va as _,X as g,Y as f,Ya as v,Yb as N,Za as p,_a as c,db as k,eb as a,fb as C,gb as h,ta as s}from"./chunk-4VXNIXON.js";var E=class o{http=x(N);base=`${O.apiBaseUrl}/categorias`;listar(){return this.http.get(this.base)}crear(e){return this.http.post(this.base,e)}actualizar(e,t){return this.http.put(`${this.base}/${e}`,t)}eliminar(e){return this.http.delete(`${this.base}/${e}`)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};function H(o,e){if(o&1&&(r(0,"div",20),a(1),i()),o&2){let t=c();s(),h(" ",t.okMsg," ")}}function R(o,e){if(o&1&&(r(0,"div",21),a(1),i()),o&2){let t=c();s(),h(" ",t.errorMsg," ")}}function U(o,e){if(o&1){let t=v();r(0,"button",22),p("click",function(){g(t);let l=c();return f(l.cancelarEdicion())}),a(1," Cancelar "),i()}}function Z(o,e){o&1&&(r(0,"div",23),a(1," Cargando... "),i())}function J(o,e){o&1&&(r(0,"div",23),a(1," No hay registros "),i())}function K(o,e){o&1&&(r(0,"span",35),a(1,"Activa"),i())}function Q(o,e){o&1&&(r(0,"span",36),a(1,"Inactiva"),i())}function W(o,e){if(o&1){let t=v();r(0,"tr",27)(1,"td",28),a(2),i(),r(3,"td",28),a(4),i(),r(5,"td",28),m(6,K,2,0,"span",30)(7,Q,2,0,"span",31),i(),r(8,"td",32)(9,"button",33),p("click",function(){let l=g(t).$implicit,u=c(2);return f(u.editar(l))}),a(10," Editar "),i(),r(11,"button",34),p("click",function(){let l=g(t).$implicit,u=c(2);return f(u.confirmarEliminar(l))}),a(12," Eliminar "),i()()()}if(o&2){let t=e.$implicit;k("opacity-60",t.estado==="I"),s(2),C(t.nombre_categoria),s(2),C(t.descripcion_categoria||"-"),s(2),d("ngIf",t.estado==="A"),s(),d("ngIf",t.estado==="I")}}function X(o,e){if(o&1&&(r(0,"div",24)(1,"table",25)(2,"thead",26)(3,"tr",27)(4,"th",28),a(5,"Nombre"),i(),r(6,"th",28),a(7,"Descripci\xF3n"),i(),r(8,"th",28),a(9,"Estado"),i(),r(10,"th",28),a(11,"Acciones"),i()()(),r(12,"tbody"),m(13,W,13,6,"tr",29),i()()()),o&2){let t=c();s(13),d("ngForOf",t.rows)}}function Y(o,e){if(o&1){let t=v();r(0,"div",37),_(1,"div",38),r(2,"div",39)(3,"h3",40),a(4,"Confirmar eliminaci\xF3n"),i(),r(5,"p",41),a(6," \xBFSeguro que deseas eliminar esta categor\xEDa? "),i(),r(7,"div",42)(8,"button",43),p("click",function(){g(t);let l=c();return f(l.closeConfirm())}),a(9," Cancelar "),i(),r(10,"button",44),p("click",function(){g(t);let l=c();return f(l.doEliminarConfirmado())}),a(11," Eliminar "),i()()()()}}var q=class o{fb=x(A);categoriasSrv=x(E);rows=[];loadingList=!1;saving=!1;okMsg="";errorMsg="";form=this.fb.nonNullable.group({nombre_categoria:["",[w.required,w.maxLength(100)]],descripcion_categoria:["",[w.maxLength(255)]]});editando=!1;editId=null;confirmOpen=!1;pendingDeleteId=null;ngOnInit(){this.loadData()}autoHideMessages(e=4e3){window.setTimeout(()=>{this.okMsg="",this.errorMsg=""},e)}showOk(e){this.okMsg=e,this.errorMsg="",this.autoHideMessages(4e3)}showError(e){this.errorMsg=e,this.okMsg="",this.autoHideMessages(4e3)}loadData(){this.loadingList=!0,this.categoriasSrv.listar().subscribe({next:e=>{this.rows=e||[],this.loadingList=!1},error:()=>{this.rows=[],this.loadingList=!1,this.showError("Error cargando categor\xEDas")}})}submit(){if(this.saving)return;let e=(this.form.value.nombre_categoria||"").trim().replace(/\s+/g," "),t=(this.form.value.descripcion_categoria||"").trim().replace(/\s+/g," ");if(!e)return this.showError("El nombre es obligatorio.");if(!/^[A-Za-zÁÉÍÓÚáéíóúÑñ\s\-.]+$/.test(e))return this.showError("El nombre solo puede contener letras, espacios, guiones y puntos.");if(e.length>100)return this.showError("El nombre admite m\xE1ximo 100 caracteres.");if(t.length>200)return this.showError("La descripci\xF3n admite m\xE1ximo 200 caracteres.");this.saving=!0,this.okMsg="",this.errorMsg="";let l={nombre_categoria:e,descripcion_categoria:t};(this.editando&&this.editId!=null?this.categoriasSrv.actualizar(this.editId,l):this.categoriasSrv.crear(l)).pipe(y(()=>{this.saving=!1})).subscribe({next:b=>{this.showOk(b?.message||(this.editando?"Categor\xEDa actualizada.":"Categor\xEDa creada.")),this.loadData(),this.editando=!1,this.editId=null,this.form.reset({nombre_categoria:"",descripcion_categoria:""}),window.scrollTo({top:0,behavior:"smooth"})},error:b=>{this.showError(b?.error?.message||"Error al guardar la categor\xEDa.")}})}editar(e){this.editando=!0,this.editId=e.id_categoria??null,this.form.patchValue({nombre_categoria:e.nombre_categoria??"",descripcion_categoria:e.descripcion_categoria??""}),window.scrollTo({top:0,behavior:"smooth"})}cancelarEdicion(){this.editando=!1,this.editId=null,this.form.reset({nombre_categoria:"",descripcion_categoria:""})}confirmarEliminar(e){this.pendingDeleteId=e.id_categoria??null,this.confirmOpen=!0}closeConfirm(){this.confirmOpen=!1,this.pendingDeleteId=null}doEliminarConfirmado(){if(this.pendingDeleteId==null){this.closeConfirm();return}let e=this.pendingDeleteId;this.confirmOpen=!1,this.pendingDeleteId=null,this.categoriasSrv.eliminar(e).subscribe({next:t=>{this.showOk(t?.message||"Categor\xEDa eliminada correctamente."),this.loadData()},error:t=>{if(t?.status===409&&t?.error){let n=t.error;if(n.requiresUpdateProducts){let l=n.message||"No se puede eliminar la categor\xEDa porque est\xE1 en uso por producto(s). Debes editar esos productos y cambiar la categor\xEDa antes de eliminarla.",u=(n.productos||[]).map(G=>`\u2022 ${G}`).join(`
`),b=n.truncated&&n.totalProductos?`

(Se muestran solo algunos; total: ${n.totalProductos})`:"";this.showError(`${l}

${u}${b}`);return}}this.showError(t?.error?.message||"Error eliminando la categor\xEDa.")}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["app-categorias"]],decls:31,vars:11,consts:[[1,"space-y-6"],[1,"text-center","text-xl","font-bold"],["class","mx-auto w-full max-w-3xl rounded-xl border border-green-500/40 bg-green-500/10 px-4 py-3 text-green-300 text-center",4,"ngIf"],["class","mx-auto w-full max-w-3xl rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-red-300 text-center whitespace-pre-line",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-2xl","bg-surface-800","border","border-white/5","p-6","sm:p-7"],[1,"text-lg","font-semibold","text-brand-500","mb-4"],["novalidate","",1,"space-y-5",3,"ngSubmit","formGroup"],[1,"block","text-sm","mb-1"],[1,"text-brand-500"],["type","text","formControlName","nombre_categoria","placeholder","Ej: Suplementos","autocomplete","off",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm"],["type","text","formControlName","descripcion_categoria","placeholder","Breve descripci\xF3n de la categor\xEDa",1,"w-full","rounded-xl","bg-surface-900","border","border-white/10","px-4","py-3","outline-none","focus:border-brand-500","placeholder:text-sm"],[1,"flex","gap-3"],["type","submit",1,"flex-1","rounded-xl","border-2","border-dashed","border-brand-500/70","text-brand-500","font-semibold","py-3","hover:bg-brand-500","hover:text-black","transition","focus-visible:outline-none","focus-visible:ring-2","focus-visible:ring-brand-500",3,"disabled"],["type","button","class","px-4 rounded-xl border border-white/10 hover:bg-white/5 transition",3,"click",4,"ngIf"],[1,"mx-auto","w-full","max-w-5xl"],[1,"rounded-2xl","bg-surface-800","border","border-white/5","overflow-hidden"],[1,"px-6","py-4","border-b","border-white/5","font-semibold"],["class","px-6 py-10 text-center text-textc-mute",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","fixed inset-0 z-[60] flex items-center justify-center",4,"ngIf"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-green-500/40","bg-green-500/10","px-4","py-3","text-green-300","text-center"],[1,"mx-auto","w-full","max-w-3xl","rounded-xl","border","border-red-500/40","bg-red-500/10","px-4","py-3","text-red-300","text-center","whitespace-pre-line"],["type","button",1,"px-4","rounded-xl","border","border-white/10","hover:bg-white/5","transition",3,"click"],[1,"px-6","py-10","text-center","text-textc-mute"],[1,"overflow-x-auto"],[1,"w-full","text-left","text-sm"],[1,"bg-surface-900/60"],[1,"border-b","border-white/5"],[1,"px-6","py-3"],["class","border-b border-white/5",3,"opacity-60",4,"ngFor","ngForOf"],["class","text-green-300",4,"ngIf"],["class","text-gray-400",4,"ngIf"],[1,"px-6","py-3","whitespace-nowrap"],["type","button",1,"text-brand-500","hover:text-brand-600","mr-3",3,"click"],["type","button",1,"text-red-400","hover:text-red-300",3,"click"],[1,"text-green-300"],[1,"text-gray-400"],[1,"fixed","inset-0","z-[60]","flex","items-center","justify-center"],[1,"absolute","inset-0","bg-black/60"],[1,"relative","z-[61]","w-full","max-w-md","rounded-2xl","bg-surface-800","border","border-white/10","p-6","shadow-xl"],[1,"text-lg","font-semibold","mb-2"],[1,"text-sm","text-textc-mute"],[1,"mt-6","flex","gap-3","justify-end"],["type","button",1,"rounded-xl","border","border-white/10","px-4","py-2","hover:bg-white/5",3,"click"],["type","button",1,"rounded-xl","bg-red-500/90","text-black","font-semibold","px-4","py-2","hover:bg-red-400",3,"click"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"h2",1),a(2,"Gesti\xF3n de Categor\xEDas"),i(),m(3,H,2,1,"div",2)(4,R,2,1,"div",3),r(5,"section",4)(6,"h3",5),a(7),i(),r(8,"form",6),p("ngSubmit",function(){return n.submit()}),r(9,"div")(10,"label",7),a(11," Nombre de la categor\xEDa "),r(12,"span",8),a(13,"*"),i()(),_(14,"input",9),i(),r(15,"div")(16,"label",7),a(17,"Descripci\xF3n"),i(),_(18,"input",10),i(),r(19,"div",11)(20,"button",12),a(21),i(),m(22,U,2,0,"button",13),i()()(),r(23,"section",14)(24,"div",15)(25,"div",16),a(26,"Listado"),i(),m(27,Z,2,0,"div",17)(28,J,2,0,"div",17)(29,X,14,1,"div",18),i()(),m(30,Y,12,0,"div",19),i()),t&2&&(s(3),d("ngIf",n.okMsg),s(),d("ngIf",n.errorMsg),s(3),h(" ",n.editando?"Editar categor\xEDa":"Agregar categor\xEDa"," "),s(),d("formGroup",n.form),s(12),d("disabled",n.saving),s(),h(" ",n.saving?"Guardando...":n.editando?"Actualizar":"Agregar"," "),s(),d("ngIf",n.editando),s(5),d("ngIf",n.loadingList),s(),d("ngIf",!n.loadingList&&n.rows.length===0),s(),d("ngIf",!n.loadingList&&n.rows.length>0),s(),d("ngIf",n.confirmOpen))},dependencies:[T,D,M,z,L,V,F,$,P,j],encapsulation:2})};export{q as Categorias};
